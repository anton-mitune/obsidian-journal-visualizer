# FEA009 Implementation Task List

## Phase 1: Code Block Syntax & Data Model Updates

### Task 1.1: Update code block parsing
- [x] Add `watchMode` parameter parsing to code block processor
- [x] Support both `watchMode: note` and `watchMode: folder` values
- [x] Add `folderPath` parameter parsing (single line)
- [x] Default to `watchMode: note` for backward compatibility with existing code blocks
- [x] Update code block writer to persist `watchMode` parameter

### Task 1.2: Add folder resolution logic
- [x] Create utility function to get all notes within a folder path
- [x] Handle nested folders (recursive or non-recursive - clarify with PO) - **defaulting to recursive=true**
- [x] Handle folder not found / invalid folder path edge cases
- [x] Make folder resolution dynamic (re-query on each render, not cached)

## Phase 2: Component State & Props Updates

### Task 2.1: Update component interfaces
- [x] Add `watchMode: 'note' | 'folder'` to component state
- [x] Add `folderPath: string[]` to component state (prepare for future multi-folder, even if single for now)
- [x] Add `onModeChange` callback prop
- [x] Add `onFolderAdded` callback prop
- [x] Add `onFolderRemoved` callback prop
- [x] Keep existing `onNoteAdded`, `onNoteRemoved` callbacks

### Task 2.2: Update component state management
- [x] Initialize `watchMode` from code block parameter (default 'folder')
- [x] Track whether component is empty (no folder and no notes)
- [x] Implement mode toggle enable/disable logic based on empty state

## Phase 3: UI Components

### Task 3.1: Create mode toggle component
- [x] Build Folder/Note toggle switch UI element
- [x] Apply visually distinct color (not too flashy, clearly visible)
- [x] Implement enabled/disabled states
- [x] Wire up `onModeChange` callback when toggle is clicked and enabled
- [x] Position in top-right corner of component

### Task 3.2: Update add button behavior
- [ ] Make add button label dynamic: "[folder icon] +" vs "[note icon] +"
- [ ] In folder mode, open folder selector modal (create if doesn't exist)
- [ ] In note mode, keep existing note selector modal behavior
- [ ] Update button to only show when callbacks are provided (code block context)

### Task 3.3: Create folder selector modal
- [ ] Create new modal component for folder selection
- [ ] List all folders in vault
- [ ] Allow single folder selection
- [ ] Trigger `onFolderAdded` callback with selected folder path
- [ ] Handle modal cancellation

### Task 3.4: Update empty state UI
- [ ] Show mode toggle in empty state
- [ ] Show placeholder text: "Add a folder or note to start showing stats"
- [ ] Ensure add button displays correctly based on mode
- [ ] Match UI mockup from spec

### Task 3.5: Update folder mode populated UI
- [ ] Display folder with ðŸ“ emoji prefix
- [ ] Show remove button (Ã—) on folder hover
- [ ] Disable mode toggle when folder is selected
- [ ] List all notes from folder with metrics
- [ ] Handle folder with 0 notes case

### Task 3.6: Update note mode populated UI
- [ ] Keep existing multi-note list display
- [ ] Show remove button (Ã—) on each note on hover
- [ ] Disable mode toggle when notes are selected
- [ ] Keep "+ Add Note" button visible in note mode

## Phase 4: Display Limit Implementation

### Task 4.1: Implement top 50 display limit
- [ ] Compute metrics for ALL notes (don't limit computation)
- [ ] Sort notes by metric value (backlink count) descending
- [ ] Display only top 50 notes
- [ ] Show "Showing top 50 of {total} notes" message when total > 50
- [ ] Apply limit to both folder and multi-note modes

## Phase 5: Code Block Persistence

### Task 5.1: Update folder mode persistence
- [ ] When folder added, write `watchMode: folder` and `folderPath: X` to code block
- [ ] When folder removed, clear `folderPath` (component returns to empty state)
- [ ] Prevent infinite refresh loop with `isUpdatingCodeblock` flag

### Task 5.2: Update note mode persistence
- [ ] When mode is note, write `watchMode: note` to code block
- [ ] Keep existing `notePath:` multi-line persistence logic
- [ ] When all notes removed, component returns to empty state

### Task 5.3: Handle mode switching persistence
- [ ] When switching from folder to note (while empty), update code block `watchMode`
- [ ] When switching from note to folder (while empty), update code block `watchMode`
- [ ] Re-enable toggle when component becomes empty (folder removed or all notes removed)


**Estimated Complexity:** Medium-High
**Dependencies:** Requires folder selector modal (new component)
**Risk Areas:** 
- Mode toggle state management
- Folder resolution performance with large folders
- Backward compatibility with existing code blocks
