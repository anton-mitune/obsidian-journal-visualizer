/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var he=Object.defineProperty;var Pe=Object.getOwnPropertyDescriptor;var we=Object.getOwnPropertyNames;var Ee=Object.prototype.hasOwnProperty;var Te=(p,e)=>{for(var t in e)he(p,t,{get:e[t],enumerable:!0})},Ne=(p,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of we(e))!Ee.call(p,i)&&i!==t&&he(p,i,{get:()=>e[i],enumerable:!(n=Pe(e,i))||n.enumerable});return p};var Be=p=>Ne(he({},"__esModule",{value:!0}),p);var xe={};Te(xe,{default:()=>ce});module.exports=Be(xe);var Me=require("obsidian");var ve={["vibrant"]:["#8b5cf6","#3b82f6","#10b981","#f59e0b","#ef4444","#ec4899","#14b8a6","#f97316","#6366f1","#84cc16"],["pastel"]:["#cdb4db","#ffc8dd","#ffafcc","#bde0fe","#a2d2ff","#9bf6ff","#fdffb6","#caffbf","#9ae6b4","#d0f4de"]},me={firstDayOfWeek:1,maxWatchedNotes:50,suggestedColorPalette:"vibrant",logLevel:3,series1Color:"#8b5cf6",series2Color:"#3b82f6",series3Color:"#10b981",series4Color:"#f59e0b",series5Color:"#ef4444",series6Color:"#ec4899",series7Color:"#14b8a6",series8Color:"#f97316",series9Color:"#6366f1",series10Color:"#84cc16"},F=(l=>(l.PAST_24_HOURS="past-24-hours",l.PAST_7_DAYS="past-7-days",l.PAST_30_DAYS="past-30-days",l.PAST_90_DAYS="past-90-days",l.PAST_YEAR="past-year",l.TODAY="today",l.THIS_WEEK="this-week",l.THIS_MONTH="this-month",l.THIS_QUARTER="this-quarter",l.THIS_YEAR="this-year",l))(F||{}),H=(i=>(i.DEFAULT="default",i.TOP_N="top-n",i.PIE="pie",i.TIME_SERIES="time-series",i))(H||{}),_=(t=>(t.NOTE="note",t.FOLDER="folder",t))(_||{});var E=class{constructor(e){this.app=e}getDailyNotesFolder(){try{let e=this.app.internalPlugins,t=e==null?void 0:e.plugins,n=t==null?void 0:t["daily-notes"],i=n==null?void 0:n.instance,r=i==null?void 0:i.options;return(r==null?void 0:r.folder)||""}catch(e){return""}}isDailyNoteFromCurrentMonth(e){let t=this.getDailyNotesFolder();if(t&&!e.path.startsWith(t))return!1;let n=e.basename.match(/(\d{4})-(\d{2})-(\d{2})/);if(!n)return!1;let[,i,r]=n,a=new Date(parseInt(i),parseInt(r)-1),o=new Date,s=o.getFullYear(),c=o.getMonth();return a.getFullYear()===s&&a.getMonth()===c}isDailyNoteFromYear(e,t){let n=this.getDailyNotesFolder();if(n&&!e.path.startsWith(n))return!1;let i=e.basename.match(/(\d{4})-(\d{2})-(\d{2})/);if(!i)return!1;let[,r]=i;return parseInt(r)===t}getYearBounds(e){let t=new Date().getFullYear(),n=new Date().getFullYear();for(let i of e)if(this.isDailyNote(i.file)){let r=this.extractDateFromDailyNote(i.file);if(r){let a=parseInt(r.substring(0,4));t=Math.min(t,a),n=Math.max(n,a)}}return t=Math.max(t-1,2e3),n=Math.min(n+1,new Date().getFullYear()+1),{minYear:t,maxYear:n}}isDailyNote(e){let t=this.getDailyNotesFolder();return t&&!e.path.startsWith(t)?!1:e.basename.match(/(\d{4})-(\d{2})-(\d{2})/)!==null}extractDateFromDailyNote(e){let t=e.basename.match(/(\d{4})-(\d{2})-(\d{2})/);return t?`${t[1]}-${t[2]}-${t[3]}`:null}filterDailyNoteBacklinks(e){return e.filter(t=>this.isDailyNoteFromCurrentMonth(t.file))}countCurrentMonthDailyNoteBacklinks(e){return this.filterDailyNoteBacklinks(e).reduce((n,i)=>n+i.linkCount,0)}getYearlyDailyNoteBacklinks(e,t=new Date().getFullYear()){let n={},i=e.filter(r=>this.isDailyNoteFromYear(r.file,t));for(let r of i){let a=this.extractDateFromDailyNote(r.file);a&&(n[a]={linkCount:r.linkCount,lines:void 0})}return n}isDailyNoteFromMonth(e,t,n){let i=this.getDailyNotesFolder();if(i&&!e.path.startsWith(i))return!1;let r=e.basename.match(/(\d{4})-(\d{2})-(\d{2})/);if(!r)return!1;let[,a,o]=r,s=parseInt(a),c=parseInt(o)-1;return s===n&&c===t}findDailyNote(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),r=`${t}-${n}-${i}`,a=this.app.vault.getMarkdownFiles();for(let o of a)if(this.isDailyNote(o)&&this.extractDateFromDailyNote(o)===r)return o;return null}getMonthlyDailyNoteBacklinks(e,t,n){let i={},r=e.filter(a=>this.isDailyNoteFromMonth(a.file,t,n));for(let a of r){let o=this.extractDateFromDailyNote(a.file);o&&(i[o]={linkCount:a.linkCount,lines:void 0})}return i}calculateMonthBounds(e){let t=new Date().getFullYear(),n=new Date().getFullYear(),i=0,r=11,a=new Date;t=a.getFullYear(),n=a.getFullYear(),i=a.getMonth(),r=a.getMonth();let o=!1;for(let s of e)if(this.isDailyNote(s.file)){let c=this.extractDateFromDailyNote(s.file);if(c){let l=new Date(c),h=l.getFullYear(),u=l.getMonth();o?((h<t||h===t&&u<i)&&(t=h,i=u),(h>n||h===n&&u>r)&&(n=h,r=u)):(t=h,n=h,i=u,r=u,o=!0)}}return o?{minMonth:i,minYear:t,maxMonth:r,maxYear:n}:{minYear:a.getFullYear()-1,minMonth:0,maxYear:a.getFullYear()+1,maxMonth:11}}getDailyBacklinksInRange(e,t,n){let i={},r=new Date(t);r.setHours(0,0,0,0);let a=new Date(n);a.setHours(23,59,59,999);for(let o of e)if(this.isDailyNote(o.file)){let s=this.extractDateFromDailyNote(o.file);if(s){let c=new Date(s);c>=r&&c<=a&&(i[s]={linkCount:o.linkCount,lines:void 0})}}return i}};var ue=require("obsidian"),Q=class{constructor(e,t){this.app=e,this.dailyNoteClassifier=t}getBacklinksForFile(e){let t=[],n=this.app.metadataCache.resolvedLinks;if(!n||typeof n!="object")return t;for(let i in n){let r=n[i];if(r&&typeof r=="object"&&r[e.path]){let a=this.app.vault.getAbstractFileByPath(i);a instanceof ue.TFile&&t.push({file:a,linkCount:r[e.path]})}}return t}analyzeNoteByPath(e,t){let n=this.app.vault.getAbstractFileByPath(e);return n instanceof ue.TFile?this.analyzeNote(n,t):null}analyzeNote(e,t){let n=this.getBacklinksForFile(e),i=t!=null?t:new Date().getFullYear(),r=this.dailyNoteClassifier.countCurrentMonthDailyNoteBacklinks(n),a=this.dailyNoteClassifier.getYearlyDailyNoteBacklinks(n,i);return{count:r,noteTitle:e.basename,yearlyData:a}}getYearlyData(e,t){let n=this.getBacklinksForFile(e);return this.dailyNoteClassifier.getYearlyDailyNoteBacklinks(n,t)}getMonthlyData(e,t,n){let i=this.getBacklinksForFile(e);return this.dailyNoteClassifier.getMonthlyDailyNoteBacklinks(i,t,n)}getYearBounds(e){let t=this.getBacklinksForFile(e);return this.dailyNoteClassifier.getYearBounds(t)}getMonthBounds(e){let t=this.getBacklinksForFile(e);return this.dailyNoteClassifier.calculateMonthBounds(t)}getClassifier(){return this.dailyNoteClassifier}};var X=class{constructor(e){this.listeners=[];this.settings=e}getSettings(){return this.settings}updateSettings(e){this.settings=e,this.notifyListeners()}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}getSeriesColors(){return[this.settings.series1Color,this.settings.series2Color,this.settings.series3Color,this.settings.series4Color,this.settings.series5Color,this.settings.series6Color,this.settings.series7Color,this.settings.series8Color,this.settings.series9Color,this.settings.series10Color]}notifyListeners(){this.listeners.forEach(e=>e(this.settings))}};var pe=require("obsidian"),Z=class{constructor(e,t,n,i){this.currentFile=null;this.currentYear=new Date().getFullYear();this.currentMonth=new Date().getMonth();this.selectedMonthYear=new Date().getFullYear();this.app=e,this.plugin=t,this.analysisService=n,this.onNoteInfoChanged=i,this.boundHandleLeafChange=this.handleLeafChange.bind(this),this.boundHandleFileOpen=this.handleFileOpen.bind(this)}setCurrentYear(e){this.currentYear=e,this.currentFile&&this.updateBacklinkCount(this.currentFile)}setCurrentMonth(e,t){this.currentMonth=e,this.selectedMonthYear=t,this.currentFile&&this.updateBacklinkCount(this.currentFile)}startWatching(){this.plugin.registerEvent(this.app.workspace.on("active-leaf-change",this.boundHandleLeafChange)),this.plugin.registerEvent(this.app.workspace.on("file-open",this.boundHandleFileOpen)),this.updateBacklinkCountForCurrentFile()}stopWatching(){}handleLeafChange(){this.updateBacklinkCountForCurrentFile()}handleFileOpen(e){e instanceof pe.TFile&&e!==this.currentFile&&(this.currentFile=e,this.updateBacklinkCount(e))}updateBacklinkCountForCurrentFile(){let e=this.app.workspace.getActiveFile();e instanceof pe.TFile&&e!==this.currentFile&&(this.currentFile=e,this.updateBacklinkCount(e))}updateBacklinkCount(e){let t=this.analysisService.analyzeNote(e,this.currentYear),n=this.analysisService.getYearBounds(e),i=this.analysisService.getMonthBounds(e);this.onNoteInfoChanged(t,n,i)}};var Se=require("obsidian");var ye=require("obsidian");var Y=class{constructor(e,t,n){this.maxIntensity=5;this.watchedNotePath=null;this.app=e,this.container=t,this.yearlyData={},this.onYearChangeCallback=n;let i=new Date().getFullYear();this.navigationState={currentYear:i,minYear:i-10,maxYear:i+1},this.yearBounds={minYear:i-10,maxYear:i+1}}updateData(e,t){this.yearlyData=e,t!==void 0&&(this.watchedNotePath=t),this.render()}setWatchedNotePath(e){this.watchedNotePath=e}setYearBounds(e){this.yearBounds=e,this.navigationState.minYear=e.minYear,this.navigationState.maxYear=e.maxYear,this.navigationState.currentYear<e.minYear?this.navigationState.currentYear=e.minYear:this.navigationState.currentYear>e.maxYear&&(this.navigationState.currentYear=e.maxYear),this.render()}setCurrentYear(e){e<this.yearBounds.minYear||e>this.yearBounds.maxYear||(this.navigationState.currentYear=e,this.render(),this.onYearChangeCallback&&this.onYearChangeCallback(e))}getCurrentYear(){return this.navigationState.currentYear}clear(){this.yearlyData={},this.render()}render(){this.container.empty();let e=this.container.createEl("div",{cls:"yearly-tracker-container"});this.watchedNotePath&&this.createNoteHeader(e),this.createHeader(e);let t=e.createEl("div",{cls:"yearly-tracker-grid"}),n=this.navigationState.currentYear,i=this.generateYearDays(n);this.createMonthLabels(t,n);let r=t.createEl("div",{cls:"yearly-tracker-days"});this.createWeekdayLabels(r),this.createDaySquares(r,i),this.createLegend(e)}createNoteHeader(e){var r,a;let t=e.createEl("div",{cls:"yearly-tracker-note-header"}),n=((a=(r=this.watchedNotePath)==null?void 0:r.split("/").pop())==null?void 0:a.replace(".md",""))||"Unknown Note";t.createEl("h4",{text:n,cls:"yearly-tracker-note-title"}).addEventListener("click",()=>{if(this.watchedNotePath){let o=this.app.vault.getAbstractFileByPath(this.watchedNotePath);o instanceof ye.TFile&&this.app.workspace.getLeaf(!1).openFile(o).catch(()=>{})}})}createHeader(e){let t=e.createEl("div",{cls:"yearly-tracker-header"});t.createEl("div",{text:"Daily note backlinks",cls:"yearly-tracker-title"});let n=t.createEl("div",{cls:"yearly-tracker-year-nav"}),i=n.createEl("button",{text:"\u2039",cls:"yearly-tracker-year-btn yearly-tracker-year-prev"});i.disabled=this.navigationState.currentYear<=this.yearBounds.minYear,i.addEventListener("click",()=>{this.navigationState.currentYear>this.yearBounds.minYear&&this.setCurrentYear(this.navigationState.currentYear-1)}),n.createEl("span",{text:this.navigationState.currentYear.toString(),cls:"yearly-tracker-current-year"});let r=n.createEl("button",{text:"\u203A",cls:"yearly-tracker-year-btn yearly-tracker-year-next"});r.disabled=this.navigationState.currentYear>=this.yearBounds.maxYear,r.addEventListener("click",()=>{this.navigationState.currentYear<this.yearBounds.maxYear&&this.setCurrentYear(this.navigationState.currentYear+1)})}generateYearDays(e){let t=[],n=new Date(e,0,1),i=new Date(e,11,31);for(let r=new Date(n);r<=i;r.setDate(r.getDate()+1))t.push(new Date(r));return t}createMonthLabels(e,t){let n=e.createEl("div",{cls:"yearly-tracker-months"});["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].forEach(r=>{n.createEl("div",{text:r,cls:"yearly-tracker-month-label"})})}createWeekdayLabels(e){let t=e.createEl("div",{cls:"yearly-tracker-weekdays"});["","Mon","","Wed","","Fri",""].forEach(i=>{t.createEl("div",{text:i,cls:"yearly-tracker-weekday-label"})})}createDaySquares(e,t){let n=e.createEl("div",{cls:"yearly-tracker-squares"}),a=(t[0].getDay()+6)%7;for(let o=0;o<a;o++)n.createEl("div",{cls:"yearly-tracker-square yearly-tracker-square-empty"});t.forEach(o=>{let s=this.formatDateString(o),c=this.yearlyData[s]||{linkCount:0},l=this.calculateIntensity(c.linkCount),h=n.createEl("div",{cls:`yearly-tracker-square yearly-tracker-square-intensity-${l}`});this.addTooltip(h,o,c)})}createLegend(e){let t=e.createEl("div",{cls:"yearly-tracker-legend"});t.createEl("span",{text:"Less",cls:"yearly-tracker-legend-label"});for(let n=0;n<=4;n++)t.createEl("div",{cls:`yearly-tracker-square yearly-tracker-square-intensity-${n} yearly-tracker-legend-square`});t.createEl("span",{text:"More",cls:"yearly-tracker-legend-label"})}formatDateString(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${i}`}calculateIntensity(e){return e===0?0:e===1?1:e===2?2:e<=4?3:4}addTooltip(e,t,n){let i=t.toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric"}),r;n.linkCount===0?r=`No backlinks on ${i}`:r=`${n.linkCount} backlink${n.linkCount>1?"s":""} on ${i}`,e.setAttribute("aria-label",r),n.linkCount>0&&(e.addClass("yearly-tracker-square-clickable"),e.addEventListener("click",()=>{this.openDailyNote(t).catch(()=>{})}))}async openDailyNote(e){let n=new E(this.app).findDailyNote(e);n&&await this.app.workspace.getLeaf(!1).openFile(n)}cleanup(){}};var ke=require("obsidian");var A=class{constructor(e,t,n){this.maxIntensity=5;this.watchedNotePath=null;this.app=e,this.container=t,this.yearlyData={},this.onMonthChangeCallback=n;let i=new Date,r=i.getMonth(),a=i.getFullYear();this.navigationState={currentMonth:r,currentYear:a,minMonth:r,minYear:a-10,maxMonth:r,maxYear:a+1},this.monthBounds={minMonth:r,minYear:a-10,maxMonth:r,maxYear:a+1}}updateData(e,t){this.yearlyData=e,t!==void 0&&(this.watchedNotePath=t),this.render()}setWatchedNotePath(e){this.watchedNotePath=e}setMonthBounds(e){this.monthBounds=e,this.navigationState.minMonth=e.minMonth,this.navigationState.minYear=e.minYear,this.navigationState.maxMonth=e.maxMonth,this.navigationState.maxYear=e.maxYear,this.isMonthBefore(this.navigationState.currentMonth,this.navigationState.currentYear,e.minMonth,e.minYear)?(this.navigationState.currentMonth=e.minMonth,this.navigationState.currentYear=e.minYear):this.isMonthAfter(this.navigationState.currentMonth,this.navigationState.currentYear,e.maxMonth,e.maxYear)&&(this.navigationState.currentMonth=e.maxMonth,this.navigationState.currentYear=e.maxYear),this.render()}setCurrentMonth(e,t){this.isMonthBefore(e,t,this.monthBounds.minMonth,this.monthBounds.minYear)||this.isMonthAfter(e,t,this.monthBounds.maxMonth,this.monthBounds.maxYear)||(this.navigationState.currentMonth=e,this.navigationState.currentYear=t,this.render(),this.onMonthChangeCallback&&this.onMonthChangeCallback(e,t))}getCurrentMonth(){return{month:this.navigationState.currentMonth,year:this.navigationState.currentYear}}goToPreviousMonth(){let e=this.navigationState.currentMonth-1,t=this.navigationState.currentYear;e<0&&(e=11,t--),this.setCurrentMonth(e,t)}goToNextMonth(){let e=this.navigationState.currentMonth+1,t=this.navigationState.currentYear;e>11&&(e=0,t++),this.setCurrentMonth(e,t)}isMonthBefore(e,t,n,i){return t<i||t===i&&e<n}isMonthAfter(e,t,n,i){return t>i||t===i&&e>n}clear(){this.yearlyData={},this.render()}render(){this.container.empty();let e=this.container.createEl("div",{cls:"monthly-tracker-container"});this.watchedNotePath&&this.createNoteHeader(e),this.createHeader(e);let t=e.createEl("div",{cls:"monthly-tracker-grid"}),n=this.generateMonthDays(this.navigationState.currentMonth,this.navigationState.currentYear);this.createWeekdayHeaders(t);let i=t.createEl("div",{cls:"monthly-tracker-days"});this.createDaySquares(i,n),this.createLegend(e)}createNoteHeader(e){var r,a;let t=e.createEl("div",{cls:"monthly-tracker-note-header"}),n=((a=(r=this.watchedNotePath)==null?void 0:r.split("/").pop())==null?void 0:a.replace(".md",""))||"Unknown Note";t.createEl("h4",{text:n,cls:"monthly-tracker-note-title"}).addEventListener("click",()=>{if(this.watchedNotePath){let o=this.app.vault.getAbstractFileByPath(this.watchedNotePath);o instanceof ke.TFile&&this.app.workspace.getLeaf(!1).openFile(o).catch(()=>{})}})}createHeader(e){let t=e.createEl("div",{cls:"monthly-tracker-header"}),n=new Date(this.navigationState.currentYear,this.navigationState.currentMonth),i=n.toLocaleDateString("en-GB",{month:"long",year:"numeric"});t.createEl("div",{text:`${i} backlinks`,cls:"monthly-tracker-title"});let r=t.createEl("div",{cls:"monthly-tracker-month-nav"}),a=r.createEl("button",{text:"\u2039",cls:"monthly-tracker-month-btn monthly-tracker-month-prev"}),o=this.navigationState.currentMonth-1,s=this.navigationState.currentYear;o<0&&(o=11,s--),a.disabled=this.isMonthBefore(o,s,this.monthBounds.minMonth,this.monthBounds.minYear),a.addEventListener("click",()=>{this.goToPreviousMonth()}),r.createEl("span",{text:n.toLocaleDateString("en-GB",{month:"short",year:"numeric"}),cls:"monthly-tracker-current-month"});let c=r.createEl("button",{text:"\u203A",cls:"monthly-tracker-month-btn monthly-tracker-month-next"}),l=this.navigationState.currentMonth+1,h=this.navigationState.currentYear;l>11&&(l=0,h++),c.disabled=this.isMonthAfter(l,h,this.monthBounds.maxMonth,this.monthBounds.maxYear),c.addEventListener("click",()=>{this.goToNextMonth()})}generateMonthDays(e,t){let n=[],i=new Date(t,e,1),r=new Date(t,e+1,0);for(let a=new Date(i);a<=r;a.setDate(a.getDate()+1))n.push(new Date(a));return n}generateCurrentMonthDays(){let e=new Date;return this.generateMonthDays(e.getMonth(),e.getFullYear())}createWeekdayHeaders(e){let t=e.createEl("div",{cls:"monthly-tracker-weekdays"});["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(i=>{t.createEl("div",{text:i,cls:"monthly-tracker-weekday-label"})})}createDaySquares(e,t){let n=e.createEl("div",{cls:"monthly-tracker-squares"}),a=(t[0].getDay()+6)%7;for(let c=0;c<a;c++)n.createEl("div",{cls:"monthly-tracker-square monthly-tracker-square-empty"});t.forEach(c=>{let l=this.formatDateString(c),h=this.yearlyData[l]||{linkCount:0},u=this.calculateIntensity(h.linkCount),m=n.createEl("div",{cls:`monthly-tracker-square monthly-tracker-square-intensity-${u}`});m.createEl("span",{text:c.getDate().toString(),cls:"monthly-tracker-square-day"}),this.addTooltip(m,c,h)});let o=n.children.length,s=42;for(let c=o;c<s;c++)n.createEl("div",{cls:"monthly-tracker-square monthly-tracker-square-empty"})}createLegend(e){let t=e.createEl("div",{cls:"monthly-tracker-legend"});t.createEl("span",{text:"Less",cls:"monthly-tracker-legend-label"});for(let n=0;n<=4;n++)t.createEl("div",{cls:`monthly-tracker-square monthly-tracker-square-intensity-${n} monthly-tracker-legend-square`});t.createEl("span",{text:"More",cls:"monthly-tracker-legend-label"})}formatDateString(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${i}`}calculateIntensity(e){return e===0?0:e===1?1:e===2?2:e<=4?3:4}addTooltip(e,t,n){let i=t.toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric"}),r;n.linkCount===0?r=`No backlinks on ${i}`:r=`${n.linkCount} backlink${n.linkCount>1?"s":""} on ${i}`,e.setAttribute("aria-label",r),n.linkCount>0&&(e.addClass("monthly-tracker-square-clickable"),e.addEventListener("click",()=>{this.openDailyNote(t).catch(()=>{})}))}async openDailyNote(e){let n=new E(this.app).findDailyNote(e);n&&await this.app.workspace.getLeaf(!1).openFile(n)}cleanup(){}};var T=require("obsidian");var y=class{static calculateDateRange(e,t=1){let n=new Date,i,r;switch(e){case"past-24-hours":i=new Date(n.getTime()-24*60*60*1e3),r=new Date(n);break;case"past-7-days":i=new Date(n.getFullYear(),n.getMonth(),n.getDate()-6,0,0,0,0),r=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);break;case"past-30-days":i=new Date(n.getFullYear(),n.getMonth(),n.getDate()-29,0,0,0,0),r=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);break;case"past-90-days":i=new Date(n.getFullYear(),n.getMonth(),n.getDate()-89,0,0,0,0),r=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);break;case"past-year":i=new Date(n.getFullYear(),n.getMonth(),n.getDate()-364,0,0,0,0),r=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);break;case"today":i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),r=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);break;case"this-week":{let a=t,s=(n.getDay()-a+7)%7,c=n.getFullYear(),l=n.getMonth(),h=n.getDate();i=new Date(c,l,h-s,0,0,0,0),r=new Date(c,l,h-s+6,23,59,59,999);break}case"this-month":i=new Date(n.getFullYear(),n.getMonth(),1,0,0,0,0),r=new Date(n.getFullYear(),n.getMonth()+1,0,23,59,59,999);break;case"this-quarter":{let o=Math.floor(n.getMonth()/3)*3;i=new Date(n.getFullYear(),o,1,0,0,0,0),r=new Date(n.getFullYear(),o+3,0,23,59,59,999);break}case"this-year":i=new Date(n.getFullYear(),0,1,0,0,0,0),r=new Date(n.getFullYear(),11,31,23,59,59,999);break;default:i=new Date(n.getTime()-30*24*60*60*1e3),r=new Date(n)}return{startDate:i,endDate:r}}static getPeriodLabel(e){switch(e){case"past-24-hours":return"past 24 hours";case"past-7-days":return"past 7 days";case"past-30-days":return"past 30 days";case"past-90-days":return"past 90 days";case"past-year":return"past year";case"today":return"today";case"this-week":return"this week";case"this-month":return"this month";case"this-quarter":return"this quarter";case"this-year":return"this year";default:return"past 30 days"}}static getAllPeriods(){return[{value:"past-24-hours",label:y.getPeriodLabel("past-24-hours")},{value:"past-7-days",label:y.getPeriodLabel("past-7-days")},{value:"past-30-days",label:y.getPeriodLabel("past-30-days")},{value:"past-90-days",label:y.getPeriodLabel("past-90-days")},{value:"past-year",label:y.getPeriodLabel("past-year")},{value:"today",label:y.getPeriodLabel("today")},{value:"this-week",label:y.getPeriodLabel("this-week")},{value:"this-month",label:y.getPeriodLabel("this-month")},{value:"this-quarter",label:y.getPeriodLabel("this-quarter")},{value:"this-year",label:y.getPeriodLabel("this-year")}]}};var I=require("obsidian");var ge=class{constructor(){this.prefix="[Vault Visualizer]";this.level=1}setLevel(e){this.level=e}getLevel(){return this.level}debug(e,...t){this.level<=0&&console.debug(`${this.prefix} [DEBUG]`,e,...t)}info(e,...t){this.level<=1&&console.debug(`${this.prefix} [INFO]`,e,...t)}warn(e,...t){this.level<=2&&console.warn(`${this.prefix} [WARN]`,e,...t)}error(e,...t){this.level<=3&&console.error(`${this.prefix} [ERROR]`,e,...t)}log(e,...t){this.level<=1&&console.debug(`${this.prefix}`,e,...t)}},g=new ge;var ee=class{constructor(e){this.app=e}getNotesInFolder(e,t=!0){if(!e||typeof e!="string")return g.warn("[FolderResolver] Invalid folder path:",e),[];let n=e.trim().replace(/^\/+|\/+$/g,""),i=this.app.vault.getAbstractFileByPath(n);if(!i)return g.warn("[FolderResolver] Folder not found:",n),[];if(!(i instanceof I.TFolder))return g.warn("[FolderResolver] Path is not a folder:",n),[];let r=[];if(t)this.collectNotesRecursive(i,r);else for(let a of i.children)a instanceof I.TFile&&a.extension==="md"&&r.push(a);return r}collectNotesRecursive(e,t){for(let n of e.children)n instanceof I.TFile&&n.extension==="md"?t.push(n):n instanceof I.TFolder&&this.collectNotesRecursive(n,t)}};var be=require("obsidian"),x=class extends be.SuggestModal{constructor(t,n){super(t);this.onSelect=n,this.files=this.app.vault.getMarkdownFiles(),this.setPlaceholder("Select a note...")}getSuggestions(t){let n=t.toLowerCase();return this.files.filter(i=>{let r=i.basename.toLowerCase(),a=i.path.toLowerCase();return r.includes(n)||a.includes(n)})}renderSuggestion(t,n){n.createEl("div",{text:t.basename}),n.createEl("small",{text:t.path,cls:"note-selector-path"})}onChooseSuggestion(t,n){this.onSelect(t)}};var R=require("obsidian"),te=class extends R.SuggestModal{constructor(t,n){super(t);this.onSelect=n,this.folders=this.getAllFolders().filter(i=>i.path!=="/"),this.setPlaceholder("Select a folder to watch...")}getAllFolders(){let t=[],n=r=>{t.push(r),r.children.forEach(a=>{a instanceof R.TFolder&&n(a)})},i=this.app.vault.getRoot();return i instanceof R.TFolder&&i.children.forEach(r=>{r instanceof R.TFolder&&n(r)}),t}getSuggestions(t){if(t==="")return this.folders;let n=t.toLowerCase();return this.folders.filter(i=>{let r=i.name.toLowerCase(),a=i.path.toLowerCase();return r.includes(n)||a.includes(n)})}renderSuggestion(t,n){n.createEl("div",{text:t.name}),n.createEl("small",{text:t.path,cls:"folder-selector-path"})}onChooseSuggestion(t,n){this.onSelect(t)}};var V=class{constructor(e){this.container=e}render(e,t){if(this.container.empty(),e.length===0){this.renderEmptyState();return}let n=this.sortResults(e);this.renderBars(n,t)}sortResults(e){return[...e].sort((t,n)=>t.count!==n.count?n.count-t.count:t.noteTitle.localeCompare(n.noteTitle))}renderBars(e,t){this.container.empty();let n=this.container.createEl("div",{cls:"top-n-container"});n.createEl("h4",{text:`Top ${e.length} notes by backlinks (${t})`,cls:"top-n-title"});let i=n.createEl("div",{cls:"top-n-chart-container"}),r=Math.max(...e.map(a=>a.count));e.forEach(a=>{let o=i.createEl("div",{cls:"top-n-bar-container"}),s=this.truncateTitle(a.noteTitle,25);o.createEl("div",{text:s,cls:"top-n-bar-label",attr:{title:a.noteTitle}});let c=o.createEl("div",{cls:"top-n-bar-wrapper"}),l=r>0?a.count/r*100:0;c.createEl("div",{cls:"top-n-bar",attr:{style:`width: ${l}%`,"data-count":a.count.toString()}}),o.createEl("div",{text:a.count.toString(),cls:"top-n-bar-count"})})}renderEmptyState(){this.container.createEl("div",{text:"No data available for top-n visualization",cls:"top-n-empty-state"})}truncateTitle(e,t){return e.length<=t?e:e.substring(0,t-3)+"..."}destroy(){}};var U=class{constructor(e){this.container=e}render(e,t,n){if(this.container.empty(),e.length===0){this.renderEmptyState();return}let i=this.sortResults(e);this.renderChart(i,t,n)}sortResults(e){return[...e].sort((t,n)=>t.count!==n.count?n.count-t.count:t.noteTitle.localeCompare(n.noteTitle))}renderChart(e,t,n){this.container.empty();let i=this.container.createEl("div",{cls:"pie-container"});i.createEl("h4",{text:`Backlink distribution (${t})`,cls:"pie-title"});let r=i.createEl("div",{cls:"pie-chart-wrapper"}),a=e.reduce((f,b)=>f+b.count,0),s=r.createEl("div",{cls:"pie-chart-container"}).createEl("div",{cls:"pie-chart-visual"}),c=[],l=0,u=n||["#8b5cf6","#3b82f6","#10b981","#f59e0b","#ef4444","#ec4899","#14b8a6","#f97316"];e.forEach((f,b)=>{let D=(a>0?f.count/a*100:0)/100*360,C=u[b%u.length],S=l,d=l+D;b===0?c.push(`${C} 0deg ${d}deg`):c.push(`${C} ${S}deg ${d}deg`),l=d}),s.style.background=`conic-gradient(from -90deg, ${c.join(", ")})`;let m=r.createEl("div",{cls:"pie-legend"});e.forEach((f,b)=>{let k=m.createEl("div",{cls:"pie-legend-item"}),D=k.createEl("div",{cls:"pie-legend-color"});D.style.backgroundColor=u[b%u.length];let C=k.createEl("div",{cls:"pie-legend-text"}),S=this.truncateTitle(f.noteTitle,30),d=a>0?(f.count/a*100).toFixed(1):0;C.createEl("span",{text:S,cls:"pie-legend-label",attr:{title:f.noteTitle}}),C.createEl("span",{text:`${f.count} (${d}%)`,cls:"pie-legend-count"})})}renderEmptyState(){this.container.createEl("div",{text:"No data available for pie visualization",cls:"pie-empty-state"})}truncateTitle(e,t){return e.length<=t?e:e.substring(0,t-3)+"..."}destroy(){}};var z=class{constructor(e){this.container=e}render(e,t){if(this.container.empty(),e.length===0||e.every(r=>r.dataPoints.length===0)){this.renderEmptyState();return}let n=this.container.createEl("div",{cls:"time-series-container"});n.createEl("h4",{text:`Backlink Evolution (${t})`,cls:"time-series-title"});let i=n.createEl("div",{cls:"time-series-chart-wrapper"});this.renderChart(i,e),this.renderLegend(n,e)}renderChart(e,t){let r={top:20,right:20,bottom:40,left:50},a=600-r.left-r.right,o=300-r.top-r.bottom,s=e.createSvg("svg",{attr:{width:"100%",height:300 .toString(),viewBox:`0 0 ${600} ${300}`,cls:"time-series-svg"}}),c=new Set;t.forEach(d=>{d.dataPoints.forEach(v=>c.add(v.date))});let l=Array.from(c).sort();if(l.length===0)return;let h=0;t.forEach(d=>{d.dataPoints.forEach(v=>{v.count>h&&(h=v.count)})});let u=Math.max(h+1,5),m=d=>r.left+d/Math.max(l.length-1,1)*a,f=d=>r.top+o-d/u*o,b=s.createSvg("g",{attr:{cls:"time-series-grid"}});for(let d=0;d<=5;d++){let v=f(d/5*u);b.createSvg("line",{attr:{x1:r.left.toString(),y1:v.toString(),x2:(r.left+a).toString(),y2:v.toString(),stroke:"var(--background-modifier-border)","stroke-width":"1","stroke-dasharray":"2,2"}})}let k=s.createSvg("g",{attr:{cls:"time-series-axes"}});k.createSvg("line",{attr:{x1:r.left.toString(),y1:r.top.toString(),x2:r.left.toString(),y2:(r.top+o).toString(),stroke:"var(--text-muted)","stroke-width":"2"}}),k.createSvg("line",{attr:{x1:r.left.toString(),y1:(r.top+o).toString(),x2:(r.left+a).toString(),y2:(r.top+o).toString(),stroke:"var(--text-muted)","stroke-width":"2"}});let D=s.createSvg("g",{attr:{cls:"time-series-labels"}});for(let d=0;d<=5;d++){let v=Math.round(d/5*u),P=f(v);D.createSvg("text",{attr:{x:(r.left-10).toString(),y:P.toString(),"text-anchor":"end","dominant-baseline":"middle",fill:"var(--text-muted)","font-size":"12"}}).textContent=v.toString()}let C=Math.max(1,Math.floor(l.length/7));l.forEach((d,v)=>{if(v%C===0||v===l.length-1){let P=m(v),w=this.formatDateLabel(d);D.createSvg("text",{attr:{x:P.toString(),y:(r.top+o+20).toString(),"text-anchor":"middle",fill:"var(--text-muted)","font-size":"11"}}).textContent=w}});let S=s.createSvg("g",{attr:{cls:"time-series-lines"}});t.forEach((d,v)=>{let P=new Map;d.dataPoints.forEach(N=>{P.set(N.date,N.count)});let w="";l.forEach((N,j)=>{let $=P.get(N)||0,K=m(j),J=f($);j===0?w+=`M ${K} ${J}`:w+=` L ${K} ${J}`}),S.createSvg("path",{attr:{d:w,fill:"none",stroke:d.color,"stroke-width":"2","stroke-linejoin":"round","stroke-linecap":"round"}});let de=S.createSvg("g",{attr:{cls:"time-series-points"}});l.forEach((N,j)=>{let $=P.get(N);if($!==void 0&&$>0){let K=m(j),J=f($);de.createSvg("circle",{attr:{cx:K.toString(),cy:J.toString(),r:"4",fill:d.color,stroke:"var(--background-primary)","stroke-width":"2"}})}})})}renderLegend(e,t){let n=e.createEl("div",{cls:"time-series-legend"});t.forEach(i=>{let r=n.createEl("div",{cls:"time-series-legend-item"}),a=r.createEl("div",{cls:"time-series-legend-color"});a.style.backgroundColor=i.color;let o=this.truncateTitle(i.noteTitle,30);r.createEl("span",{text:o,cls:"time-series-legend-label",attr:{title:i.noteTitle}})})}formatDateLabel(e){let t=e.split("-");if(t.length===3){let n=parseInt(t[1]),i=parseInt(t[2]);return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n-1]} ${i}`}return e}renderEmptyState(){this.container.createEl("div",{text:"No data available for time-series visualization",cls:"time-series-empty-state"})}truncateTitle(e,t){return e.length<=t?e:e.substring(0,t-3)+"..."}destroy(){}};function Ce(p,e){return p.map((t,n)=>{let i=[];for(let[r,a]of Object.entries(t.data))i.push({date:r,count:a.linkCount});return i.sort((r,a)=>r.date.localeCompare(a.date)),{noteTitle:t.noteTitle,notePath:t.notePath,dataPoints:i,color:e[n%e.length]}})}var L=class{constructor(e,t,n,i,r,a,o,s,c,l,h,u){this.counterResults=[];this.container=e,this.app=t,this.classifier=n,this.analysisService=i,this.settingsService=r,this.folderResolver=new ee(t),this.onPeriodChangeCallback=a,this.onNoteAddedCallback=o,this.onNoteRemovedCallback=s,this.onDisplayModeChangeCallback=c,this.onModeChangeCallback=l,this.onFolderAddedCallback=h,this.onFolderRemovedCallback=u,this.state={selectedPeriod:"past-30-days",displayAs:"default",watchMode:"folder"},this.topNRenderer=new V(this.container),this.pieRenderer=new U(this.container),this.timeSeriesRenderer=new z(this.container),this.unsubscribeSettings=this.settingsService.subscribe(()=>{this.updateCounts(),this.render()})}cleanup(){this.unsubscribeSettings&&this.unsubscribeSettings()}updateWatchedItems(e){this.state.notePath=e.notePath?Array.isArray(e.notePath)?e.notePath:[e.notePath]:void 0,e.displayAs!==void 0&&(this.state.displayAs=e.displayAs),e.watchMode!==void 0&&(this.state.watchMode=e.watchMode),e.folderPath!==void 0&&(this.state.folderPath=Array.isArray(e.folderPath)?e.folderPath:[e.folderPath]),this.updateCounts(),this.render()}updateData(e,t,n){n&&(this.state.notePath=[n]);let i=this.calculateCountForBacklinks(e);this.counterResults=[{notePath:n||"",noteTitle:t||"Unknown",count:i}],this.render()}setSelectedPeriod(e){this.state.selectedPeriod=e,this.updateCounts(),this.render()}setDisplayMode(e){this.state.displayAs=e,this.render()}clear(){this.counterResults=[],this.container.empty()}addNote(e){this.onNoteAddedCallback&&this.onNoteAddedCallback(e)}removeNote(e){this.onNoteRemovedCallback&&this.onNoteRemovedCallback(e)}changeWatchMode(e){this.onModeChangeCallback&&this.onModeChangeCallback(e)}addFolder(e){this.onFolderAddedCallback&&this.onFolderAddedCallback(e)}removeFolder(){this.onFolderRemovedCallback&&this.onFolderRemovedCallback()}isEmpty(){let e=this.state.notePath&&this.state.notePath.length>0,t=this.state.folderPath&&this.state.folderPath.length>0;return!e&&!t}isModeToggleEnabled(){return this.isEmpty()}updateCounts(){if(this.counterResults=[],(this.state.watchMode||"folder")==="folder"){if(this.state.folderPath&&this.state.folderPath.length>0){let t=this.state.folderPath[0],n=this.folderResolver.getNotesInFolder(t);for(let i of n){let r=this.analysisService.getBacklinksForFile(i),a=this.calculateCountForBacklinks(r);this.counterResults.push({notePath:i.path,noteTitle:i.basename,count:a})}g.log("[BacklinkCounter] Folder mode - found",n.length,"notes in",t)}}else if(this.state.notePath&&this.state.notePath.length>0){typeof this.state.notePath=="string"&&(this.state.notePath=[this.state.notePath]);for(let t of this.state.notePath){let n=this.app.vault.getAbstractFileByPath(t);if(n instanceof T.TFile){let i=this.analysisService.getBacklinksForFile(n);g.warn("[BacklinkCounter] Calculating count for note:",n.path,i);let r=this.calculateCountForBacklinks(i);this.counterResults.push({notePath:n.path,noteTitle:n.basename,count:r})}}}}calculateCountForBacklinks(e){if(e.length===0)return 0;let t=this.settingsService.getSettings().firstDayOfWeek,n=y.calculateDateRange(this.state.selectedPeriod,t),i=0;g.log("[BacklinkCounter] Date range:",{period:this.state.selectedPeriod,startDate:n.startDate.toISOString(),endDate:n.endDate.toISOString()});for(let r of e)if(this.classifier.isDailyNote(r.file)){let a=this.classifier.extractDateFromDailyNote(r.file);if(a){let o=this.parseDateString(a);if(o){let s=o>=n.startDate&&o<=n.endDate;g.log("[BacklinkCounter] Checking daily note:",{file:r.file.path,dateString:a,fileDate:o.toISOString(),isInRange:s,linkCount:r.linkCount}),s&&(i+=r.linkCount)}}}return g.log("[BacklinkCounter] Final count:",i),i}parseDateString(e){let t=e.match(/(\d{4})-(\d{2})-(\d{2})/);if(!t)return null;let[,n,i,r]=t;return new Date(parseInt(n),parseInt(i)-1,parseInt(r),0,0,0,0)}onPeriodChange(e){this.state.selectedPeriod=e,this.updateCounts(),this.render(),this.onPeriodChangeCallback&&this.onPeriodChangeCallback(e)}onDisplayModeChange(e){this.state.displayAs=e,this.render(),this.onDisplayModeChangeCallback&&this.onDisplayModeChangeCallback(e)}render(){this.container.empty(),this.container.addClass("backlink-counter-component"),this.renderControls();let e=this.state.displayAs||"default";e==="top-n"?this.renderTopNMode():e==="pie"?this.renderPieMode():e==="time-series"?this.renderTimeSeriesMode():this.renderDefaultMode()}renderModeToggle(e){if(!this.onModeChangeCallback)return;let t=e.createEl("div",{cls:"watch-mode-toggle-container"}),n=this.state.watchMode||"folder",i=this.isModeToggleEnabled(),r=t.createEl("div",{cls:`watch-mode-toggle ${i?"enabled":"disabled"}`}),a=r.createEl("button",{cls:`watch-mode-option ${n==="folder"?"active":""}`,text:"Folder",attr:{"aria-label":"Watch folder mode",disabled:i?null:"true"}}),o=r.createEl("button",{cls:`watch-mode-option ${n==="note"?"active":""}`,text:"Note",attr:{"aria-label":"Watch note mode",disabled:i?null:"true"}});i&&(a.addEventListener("click",()=>{n!=="folder"&&this.changeWatchMode("folder")}),o.addEventListener("click",()=>{n!=="note"&&this.changeWatchMode("note")}))}renderControls(){var o;let e=this.container.createEl("div",{cls:"backlink-counter-controls"});if(this.renderModeToggle(e),this.shouldShowDisplayModeToggle()){let s=this.state.displayAs||"default",c=e.createEl("button",{cls:"backlink-counter-mode-toggle",attr:{"aria-label":this.getDisplayModeLabel(s)}});(0,T.setIcon)(c,this.getDisplayModeIcon(s)),c.addEventListener("click",()=>{let l=this.getNextDisplayMode(s);this.onDisplayModeChange(l)})}let t=e.createEl("select",{cls:"backlink-counter-dropdown"});y.getAllPeriods().forEach(s=>{let c=t.createEl("option",{text:s.label,value:s.value});s.value===this.state.selectedPeriod&&(c.selected=!0)}),t.addEventListener("change",()=>{this.onPeriodChange(t.value)});let i=this.state.watchMode||"folder",r=this.onFolderAddedCallback,a=this.onNoteAddedCallback;if(i==="folder"&&r||i==="note"&&a){let s=((o=this.state.notePath)==null?void 0:o.length)||0,c=this.settingsService.getSettings().maxWatchedNotes,l=i==="folder",h=this.state.folderPath&&this.state.folderPath.length>0,u=l?h:s>=c,m=e.createEl("button",{cls:`backlink-counter-add-button ${u?"disabled":""}`,attr:{"aria-label":u?l?"A folder is already selected":`Maximum limit of ${c} notes reached`:l?"Add folder to watch":"Add note to watch"}}),f=" +";m.textContent=f,(0,T.setIcon)(m,l?"folder-plus":"plus"),u?m.disabled=!0:m.addEventListener("click",()=>{l?this.showFolderSelector():this.showNoteSelector()})}}shouldShowDisplayModeToggle(){return this.counterResults.length>1}renderDefaultMode(){if(this.counterResults.length===0)this.renderEmptyState();else{let e=this.state.watchMode||"folder";if(e==="folder"&&this.state.folderPath&&this.state.folderPath.length>0&&this.renderFolderHeader(),this.counterResults.length===1&&e==="note"){let t=this.counterResults[0],n=this.container.createEl("div",{cls:"backlink-counter-display"});n.createEl("div",{cls:"backlink-counter-number",text:t.count.toString()}),n.createEl("div",{cls:"backlink-counter-label",text:this.getCountLabel(t.count)})}else{let t=this.container.createEl("div",{cls:"backlink-counter-list"});this.counterResults.sort((o,s)=>s.count-o.count);let n=this.settingsService.getSettings().maxWatchedNotes,i=this.counterResults.slice(0,n),r=this.counterResults.length,a=r>n;for(let o of i){let s=t.createEl("div",{cls:"backlink-counter-item"});if(s.createEl("div",{cls:"backlink-counter-item-title",text:o.noteTitle}),s.createEl("div",{cls:"backlink-counter-item-count",text:`${o.count} ${o.count===1?"backlink":"backlinks"}`}),this.onNoteRemovedCallback&&e==="note"){let c=s.createEl("button",{cls:"backlink-counter-item-remove",attr:{"aria-label":`Remove ${o.noteTitle}`}});(0,T.setIcon)(c,"x"),c.addEventListener("click",l=>{l.stopPropagation(),this.removeNote(o.notePath)})}}a&&t.createEl("div",{cls:"backlink-counter-limit-message",text:`Showing top ${n} of ${r} notes`})}}}renderEmptyState(){let e=this.container.createEl("div",{cls:"backlink-counter-empty-state"}),t=e.createEl("div",{cls:"empty-state-icon"});(0,T.setIcon)(t,"inbox"),e.createEl("div",{cls:"empty-state-text",text:"Add a folder or note to start showing stats"}),e.createEl("div",{cls:"empty-state-hint",text:`Click the ${this.state.watchMode==="folder"?"folder":"note"} button above to get started`})}renderFolderHeader(){var i;let e=(i=this.state.folderPath)==null?void 0:i[0];if(!e)return;let t=this.container.createEl("div",{cls:"backlink-counter-folder-header"}),n=t.createEl("div",{cls:"folder-info"});if(n.createEl("span",{cls:"folder-icon",text:"\u{1F4C1}"}),n.createEl("span",{cls:"folder-name",text:e.endsWith("/")?e:e+"/"}),this.onFolderRemovedCallback){let r=t.createEl("button",{cls:"folder-remove-button",attr:{"aria-label":`Remove folder ${e}`}});(0,T.setIcon)(r,"x"),r.addEventListener("click",a=>{a.stopPropagation(),this.removeFolder()})}}renderTopNMode(){let e=this.container.createEl("div",{cls:"backlink-counter-top-n"}),t=this.settingsService.getSettings().maxWatchedNotes,n=this.counterResults.slice(0,t);this.topNRenderer=new V(e);let i=y.getPeriodLabel(this.state.selectedPeriod);this.topNRenderer.render(n,i),this.counterResults.length>t&&e.createEl("div",{cls:"backlink-counter-limit-message",text:`Showing top ${t} of ${this.counterResults.length} notes`})}renderPieMode(){let e=this.container.createEl("div",{cls:"backlink-counter-pie"}),t=this.settingsService.getSettings().maxWatchedNotes,n=this.counterResults.slice(0,t);this.pieRenderer=new U(e);let i=y.getPeriodLabel(this.state.selectedPeriod),r=this.settingsService.getSeriesColors();this.pieRenderer.render(n,i,r),this.counterResults.length>t&&e.createEl("div",{cls:"backlink-counter-limit-message",text:`Showing top ${t} of ${this.counterResults.length} notes`})}renderTimeSeriesMode(){let e=this.container.createEl("div",{cls:"backlink-counter-time-series"}),t=this.settingsService.getSettings().maxWatchedNotes,n=this.counterResults.slice(0,t),i=this.settingsService.getSettings().firstDayOfWeek,r=y.calculateDateRange(this.state.selectedPeriod,i),a=[];for(let l of n){let h=this.app.vault.getAbstractFileByPath(l.notePath);if(h instanceof T.TFile){let u=this.analysisService.getBacklinksForFile(h),m=this.classifier.getDailyBacklinksInRange(u,r.startDate,r.endDate);a.push({notePath:h.path,noteTitle:h.basename,data:m})}}let o=this.settingsService.getSeriesColors(),s=Ce(a,o);this.timeSeriesRenderer=new z(e);let c=y.getPeriodLabel(this.state.selectedPeriod);this.timeSeriesRenderer.render(s,c),this.counterResults.length>t&&e.createEl("div",{cls:"backlink-counter-limit-message",text:`Showing top ${t} of ${this.counterResults.length} notes`})}showNoteSelector(){new x(this.app,t=>{this.addNote(t.path)}).open()}showFolderSelector(){new te(this.app,t=>{this.addFolder(t.path)}).open()}getCountLabel(e){let t=y.getPeriodLabel(this.state.selectedPeriod);return`${e===1?"backlink":"backlinks"} in the ${t}`}getDisplayModeIcon(e){switch(e){case"default":return"list";case"top-n":return"bar-chart-2";case"pie":return"pie-chart";case"time-series":return"trending-up";default:return"list"}}getDisplayModeLabel(e){switch(e){case"default":return"Switch to bar chart view";case"top-n":return"Switch to pie chart view";case"pie":return"Switch to time-series view";case"time-series":return"Switch to list view";default:return"Switch display mode"}}getNextDisplayMode(e){switch(e){case"default":return"top-n";case"top-n":return"pie";case"pie":return"time-series";case"time-series":return"default";default:return"default"}}};var O="note-insights-view",ne=class extends Se.ItemView{constructor(t){super(t);this.currentNoteInfo=null;this.yearlyTracker=null;this.monthlyTracker=null;this.backlinkCounter=null;this.yearBounds=null;this.monthBounds=null;this.analysisService=null;this.settingsService=null;this.classifier=new E(this.app)}setAnalysisService(t){this.analysisService=t,this.containerEl.isShown()&&this.loadCurrentActiveNote()}setSettingsService(t){this.settingsService=t}getViewType(){return O}getDisplayText(){return"Note insights"}getIcon(){return"bar-chart-3"}updateNoteInfo(t,n,i){this.currentNoteInfo=t,n&&(this.yearBounds=n),i&&(this.monthBounds=i),this.render()}setOnYearChangeCallback(t){this.onYearChangeCallback=t}setOnMonthChangeCallback(t){this.onMonthChangeCallback=t}clearNoteInfo(){this.currentNoteInfo=null,this.yearlyTracker&&this.yearlyTracker.clear(),this.monthlyTracker&&this.monthlyTracker.clear(),this.backlinkCounter&&this.backlinkCounter.clear(),this.render()}render(){let t=this.containerEl;t.empty(),t.addClass("note-insights-view"),t.createEl("div",{cls:"note-insights-header"}).createEl("h3",{text:"Note insights",cls:"note-insights-title"});let i=t.createEl("div",{cls:"note-insights-content"});this.currentNoteInfo?this.renderNoteInsights(i):this.renderEmptyState(i)}renderEmptyState(t){t.createEl("div",{cls:"note-insights-empty"}).createEl("p",{text:"Open a note to see insights",cls:"note-insights-empty-text"})}renderNoteInsights(t){if(!this.currentNoteInfo)return;let n=t.createEl("div",{cls:"note-insights-section"});n.createEl("div",{text:"Active note",cls:"note-insights-label"}),n.createEl("div",{text:this.currentNoteInfo.noteTitle,cls:"note-insights-note-title"});let i=t.createEl("div",{cls:"note-insights-section"});if(i.createEl("div",{text:"Counter",cls:"note-insights-label"}),this.analysisService&&this.settingsService){this.backlinkCounter&&this.backlinkCounter.cleanup();let r=i.createEl("div",{cls:"note-insights-backlink-counter"});this.backlinkCounter=new L(r,this.app,this.classifier,this.analysisService,this.settingsService);let a=this.app.workspace.getActiveFile();if(a){let o=this.analysisService.getBacklinksForFile(a);g.log("[NoteInsightsView] Counter - updating with backlinks:",o.length),this.backlinkCounter.updateData(o,a.basename,a.path)}else g.warn("[NoteInsightsView] Counter - no active file")}else g.error("[NoteInsightsView] Counter - analysisService is null! Cannot create counter."),i.createEl("div",{text:"Counter unavailable (service not initialized)",cls:"note-insights-error"});if(this.currentNoteInfo.yearlyData){let r=t.createEl("div",{cls:"note-insights-section"});r.createEl("div",{text:"Monthly tracker",cls:"note-insights-label"});let a=r.createEl("div",{cls:"note-insights-monthly-tracker"});this.monthlyTracker=new A(this.app,a,this.onMonthChangeCallback);let o=this.app.workspace.getActiveFile();o?this.monthlyTracker.updateData(this.currentNoteInfo.yearlyData,o.path):this.monthlyTracker.updateData(this.currentNoteInfo.yearlyData),this.monthBounds&&this.monthlyTracker.setMonthBounds(this.monthBounds)}if(this.currentNoteInfo.yearlyData){let r=t.createEl("div",{cls:"note-insights-section"});r.createEl("div",{text:"Yearly tracker",cls:"note-insights-label"});let a=r.createEl("div",{cls:"note-insights-yearly-tracker"});this.yearlyTracker=new Y(this.app,a,this.onYearChangeCallback);let o=this.app.workspace.getActiveFile();o?this.yearlyTracker.updateData(this.currentNoteInfo.yearlyData,o.path):this.yearlyTracker.updateData(this.currentNoteInfo.yearlyData),this.yearBounds&&this.yearlyTracker.setYearBounds(this.yearBounds)}}async onOpen(){this.loadCurrentActiveNote(),this.render()}loadCurrentActiveNote(){if(!this.analysisService)return;let t=this.app.workspace.getActiveFile();if(!t){this.clearNoteInfo();return}let n=this.analysisService.analyzeNote(t),i=this.analysisService.getYearBounds(t),r=this.analysisService.getMonthBounds(t);this.updateNoteInfo(n,i,r)}async onClose(){this.backlinkCounter&&this.backlinkCounter.cleanup(),this.currentNoteInfo=null,this.yearlyTracker=null,this.monthlyTracker=null,this.backlinkCounter=null}};var ie=class{constructor(e,t,n,i){this.view=null;this.app=e,this.plugin=t,this.analysisService=n,this.settingsService=i}setOnYearChangeCallback(e){this.onYearChangeCallback=e,this.view&&this.view.setOnYearChangeCallback(e)}setOnMonthChangeCallback(e){this.onMonthChangeCallback=e,this.view&&this.view.setOnMonthChangeCallback(e)}registerView(){this.plugin.registerView(O,e=>{let t=new ne(e);return t.setAnalysisService(this.analysisService),t.setSettingsService(this.settingsService),this.onYearChangeCallback&&t.setOnYearChangeCallback(this.onYearChangeCallback),this.onMonthChangeCallback&&t.setOnMonthChangeCallback(this.onMonthChangeCallback),this.view=t,t}),this.plugin.addRibbonIcon("bar-chart-3","Note insights",async()=>{await this.activateView()})}async activateView(){var e;try{let t=(e=this.app.workspace.getLeavesOfType(O))==null?void 0:e[0];if(t)this.app.workspace.revealLeaf(t),this.view=t.view;else{let n=this.app.workspace.getRightLeaf(!1);n&&await n.setViewState({type:O,active:!0})}}catch(t){g.error("Vault Visualizer: Error activating view:",t)}}updateNoteInfo(e,t,n){this.ensureViewReference(),this.view&&typeof this.view.updateNoteInfo=="function"?this.view.updateNoteInfo(e,t,n):console.debug("Vault Visualizer: View not ready to update")}ensureViewReference(){var e;if(!this.view){let t=(e=this.app.workspace.getLeavesOfType(O))==null?void 0:e[0];if(t){if(this.view=t.view,!this.view.setAnalysisService)return;this.view.setAnalysisService(this.analysisService),this.onYearChangeCallback&&this.view.setOnYearChangeCallback(this.onYearChangeCallback),this.onMonthChangeCallback&&this.view.setOnMonthChangeCallback(this.onMonthChangeCallback)}}}clearNoteInfo(){this.view&&this.view.clearNoteInfo()}getView(){return this.view}cleanup(){this.view=null}};var De=require("obsidian");var fe=require("obsidian");var B=class{constructor(e,t){this.instances=new Map;this.app=e,this.plugin=t}cleanupInstance(e){let t=this.instances.get(e);t&&(t.component&&typeof t.component.cleanup=="function"&&t.component.cleanup(),t.eventRef&&this.app.metadataCache.offref(t.eventRef),this.instances.delete(e))}getActiveCanvasFile(){let e=this.app.workspace.getMostRecentLeaf();if(!e)return null;let t=e.view;if(t.getViewType()!=="canvas")return null;let n=t.file;return!n||!(n instanceof fe.TFile)?null:n}isCanvasContext(e){return!e.sourcePath||e.sourcePath===""}parseCodeBlockConfig(e){let t={},n=e.trim().split(`
`);for(let i of n){let r=i.trim(),a=r.indexOf(":");if(a>0){let o=r.substring(0,a).trim(),s=r.substring(a+1).trim();if(o in t){let c=t[o];Array.isArray(c)?c.push(s):t[o]=[c,s]}else t[o]=s}}return t}generateInstanceId(e){return`${e.sourcePath}-${Date.now()}-${Math.random()}`}generateCodeblockId(){return Math.random().toString(36).substring(2,8)}async ensureCodeblockId(e,t,n){n||await this.updateCodeblockProperty(e,t,"id",t.codeblockId)}async updateCodeblockProperty(e,t,n,i){let r=this.normalizePropertyValue(i);this.isCanvasContext(e)?await this.updateCanvasNode(t,n,r):await this.updateNote(e,t,n,r)}normalizePropertyValue(e){return Array.isArray(e)?e.map(t=>String(t)):[String(e)]}async updateCanvasNode(e,t,n){let i=this.getActiveCanvasFile();if(!i){g.error("[BaseCodeBlockProcessor] No active canvas file found");return}try{let r=await this.app.vault.read(i),a=JSON.parse(r),o=[];for(let s of a.nodes||[])s.type==="text"&&typeof s.text=="string"&&s.text.includes("```note-insight-")&&s.text.includes(`id: ${e.codeblockId}`)&&o.push(s);if(o.length===0){g.warn("[BaseCodeBlockProcessor] No matching canvas nodes found for ID:",e.codeblockId);return}for(let s of o){let c=s.text.split(`
`),l=this.updateCodeblockContent(c,e.codeblockId,t,n);s.text=l.join(`
`)}await this.app.vault.modify(i,JSON.stringify(a,null,2))}catch(r){g.error("[BaseCodeBlockProcessor] Canvas update error:",r)}}async updateNote(e,t,n,i){let r=this.app.vault.getAbstractFileByPath(e.sourcePath);if(!r||!(r instanceof fe.TFile)){g.error("[BaseCodeBlockProcessor] File not found:",e.sourcePath);return}try{let o=(await this.app.vault.read(r)).split(`
`),c=this.updateCodeblockContent(o,t.codeblockId,n,i).join(`
`);await this.app.vault.modify(r,c)}catch(a){g.error("[BaseCodeBlockProcessor] Note update error:",a)}}updateCodeblockContent(e,t,n,i){let r=!1,a=-1,o=-1,s=[];for(let l=0;l<e.length;l++){let h=e[l].trim();if(h.startsWith("```note-insight-"))r=!1,a=l;else if(r===!1&&a!==-1&&h.startsWith("id:")&&h.includes(t)){let u=h.match(/^id:\s*(.+)$/);u&&u[1].trim()===t&&(r=!0)}else if(h==="```"&&a!==-1)if(r){o=l;break}else a=-1,r=!1,s.length=0;r&&h.startsWith(`${n}:`)&&s.push(l)}if(a===-1||o===-1)return g.warn("[BaseCodeBlockProcessor] Target codeblock not found for ID:",t),e;for(let l=s.length-1;l>=0;l--)e.splice(s[l],1);let c=o-s.length-1;for(let l=0;l<i.length;l++){let h=`${n}: ${i[l]}`;e.splice(c+l+1,0,h)}return e}unload(){for(let e of this.instances.keys())this.cleanupInstance(e);this.instances.clear()}};function W(p,e,t=!1){let n=null;return(...i)=>{let r=()=>{n=null,t||p(...i)},a=t&&!n;n&&clearTimeout(n),n=setTimeout(r,e),a&&p(...i)}}var re=class extends B{constructor(t,n,i,r){super(t,n);this.analysisService=i,this.settingsService=r}register(){this.plugin.registerMarkdownCodeBlockProcessor("note-insight-counter",this.process.bind(this))}process(t,n,i){var r,a,o;try{let s=this.parseConfig(t);if(!s){n.createEl("div",{text:"Error: note path or note paths not specified",cls:"note-insight-error"});return}let c=s.notePath&&s.notePath.length>0,l=s.folderPath&&s.folderPath.length>0;if(!(!c&&!l)&&!c&&!l){n.createEl("div",{text:"Error: note path or folder path must be specified",cls:"note-insight-error"});return}if(!s.id){n.createEl("div",{text:"Error: codeblock ID missing. Please insert codeblock using the context menu.",cls:"note-insight-error"});return}this.cleanupInstance(s.id);let u=n.createEl("div",{cls:"note-insight-code-block counter"}),m=u.createEl("div",{cls:"backlink-counter-wrapper"}),f=new L(m,this.app,this.analysisService.getClassifier(),this.analysisService,this.settingsService,d=>this.onPeriodChanged(i,s.id,d),d=>this.onNoteAdded(i,s.id,d),d=>this.onNoteRemoved(i,s.id,d),d=>this.onDisplayModeChanged(i,s.id,d),d=>this.onWatchModeChanged(i,s.id,d),d=>this.onFolderAdded(i,s.id,d),()=>this.onFolderRemoved(i,s.id)),b=(r=s.selectedPeriod)!=null?r:"past-30-days",k=(a=s.displayAs)!=null?a:"default",D=(o=s.watchMode)!=null?o:"note";f.setSelectedPeriod(b),f.setDisplayMode(k),f.updateWatchedItems({notePath:s.notePath,displayAs:k,watchMode:D,folderPath:s.folderPath});let C=this.app.metadataCache.on("resolved",W(()=>{var w;let d=this.instances.get(s.id);if(!d||d.isUpdatingCodeblock)return;let v=(w=s.displayAs)!=null?w:"default";d.notePath&&d.notePath.length>0?f.updateWatchedItems({notePath:d.notePath,displayAs:v}):s.folderPath&&f.updateWatchedItems({folderPath:s.folderPath,displayAs:v,watchMode:"folder"})},5e3));this.plugin.registerEvent(C),this.instances.set(s.id,{component:f,codeblockId:s.id,eventRef:C,type:"counter",ctx:i,el:n,lastKnownPeriod:b,isUpdatingCodeblock:!1,notePath:s.notePath});let S=new De.MarkdownRenderChild(u);S.onunload=()=>{this.cleanupInstance(s.id)},i.addChild(S)}catch(s){g.error("[CounterCodeBlockProcessor] Error:",s);let c="Error rendering counter";s instanceof Error&&(c=`Error rendering counter: ${s.message}`),n.createEl("div",{text:c,cls:"note-insight-error"})}}parseConfig(t){let n=this.parseCodeBlockConfig(t),i={};if(typeof n.id!="string"||!n.id)throw new Error("Invalid code block config: missing required 'id' property");if(i.id=n.id,typeof n.notePath=="string"?i.notePath=[n.notePath]:Array.isArray(n.notePath)?i.notePath=n.notePath:i.notePath=[],n.watchMode&&Object.values(_).includes(n.watchMode)?i.watchMode=n.watchMode:i.watchMode="note",typeof n.folderPath=="string")n.folderPath&&n.folderPath!=="undefined"&&(i.folderPath=n.folderPath);else if(n.folderPath){let r=JSON.stringify(n.folderPath);r&&r!=="undefined"&&(i.folderPath=r)}return n.selectedPeriod&&Object.values(F).includes(n.selectedPeriod)?i.selectedPeriod=n.selectedPeriod:i.selectedPeriod="past-30-days",n.displayMode&&Object.values(H).includes(n.displayMode)?i.displayMode=n.displayMode:i.displayMode="default",this.config={id:i.id,notePath:i.notePath,watchMode:Object.values(_).includes(i.watchMode)?i.watchMode:"note",folderPath:i.folderPath,selectedPeriod:Object.values(F).includes(i.selectedPeriod)?i.selectedPeriod:"past-30-days",displayAs:Object.values(H).includes(i.displayMode)?i.displayMode:"default"},JSON.parse(JSON.stringify(this.config))}onPeriodChanged(t,n,i){let r=this.instances.get(n);g.warn("[CounterCodeBlockProcessor] Period changing to",i,"for instance",n,r),!(!r||r.isUpdatingCodeblock)&&r.lastKnownPeriod!==i&&(r.isUpdatingCodeblock=!0,this.updateCodeblockProperty(t,r,"selectedPeriod",i).catch(()=>{}),window.setTimeout(()=>{r.isUpdatingCodeblock=!1},100))}onDisplayModeChanged(t,n,i){let r=this.instances.get(n);!r||r.isUpdatingCodeblock||(r.isUpdatingCodeblock=!0,this.updateCodeblockProperty(t,r,"displayAs",i).catch(()=>{}),setTimeout(()=>{r.isUpdatingCodeblock=!1},100))}onNoteAdded(t,n,i){var a;g.log("[CounterCodeBlockProcessor] Adding note to watch list:",i);let r=this.instances.get(n);if(!(!r||r.isUpdatingCodeblock)){if(r.isUpdatingCodeblock=!0,(a=this.config)!=null&&a.notePath){let o=Array.isArray(this.config.notePath)?this.config.notePath:[this.config.notePath];o.includes(i)||(o.push(i),this.config.notePath=o,this.updateCodeblockProperty(t,r,"notePath",this.config.notePath).catch(()=>{}))}setTimeout(()=>{r.isUpdatingCodeblock=!1},100)}}onNoteRemoved(t,n,i){var a;let r=this.instances.get(n);if(!(!r||r.isUpdatingCodeblock)){if(r.isUpdatingCodeblock=!0,(a=this.config)!=null&&a.notePath){let o=Array.isArray(this.config.notePath)?this.config.notePath:[this.config.notePath];if(o.includes(i)){let s=o.filter(c=>c!==i);this.config.notePath=s,this.updateCodeblockProperty(t,r,"notePath",this.config.notePath).catch(()=>{})}}setTimeout(()=>{r.isUpdatingCodeblock=!1},100)}}onWatchModeChanged(t,n,i){let r=this.instances.get(n);!r||r.isUpdatingCodeblock||(r.isUpdatingCodeblock=!0,this.updateCodeblockProperty(t,r,"watchMode",i).catch(()=>{}),setTimeout(()=>{r.isUpdatingCodeblock=!1},100))}onFolderAdded(t,n,i){let r=this.instances.get(n);!r||r.isUpdatingCodeblock||(r.isUpdatingCodeblock=!0,this.updateCodeblockProperty(t,r,"folderPath",i).catch(()=>{}),setTimeout(()=>{r.isUpdatingCodeblock=!1},100))}onFolderRemoved(t,n){let i=this.instances.get(n);!i||i.isUpdatingCodeblock||(i.isUpdatingCodeblock=!0,this.updateCodeblockProperty(t,i,"folderPath",[]).catch(()=>{}),setTimeout(()=>{i.isUpdatingCodeblock=!1},100))}};var q=require("obsidian");var ae=class extends B{constructor(t,n,i){super(t,n);this.analysisService=i}register(){this.plugin.registerMarkdownCodeBlockProcessor("note-insight-yearly",this.process.bind(this))}process(t,n,i){try{let r=this.parseConfig(t);if(!r){n.createEl("div",{text:"Error: codeblock ID missing. Please insert codeblock using the context menu.",cls:"note-insight-error"});return}let{id:a,notePath:o,selectedYear:s}=r;if(!o){n.createEl("div",{text:"Error: note path must be specified",cls:"note-insight-error"});return}let c=this.app.vault.getAbstractFileByPath(o);if(!c){n.createEl("div",{text:`Error: note not found: ${o}`,cls:"note-insight-error"});return}if(!(c instanceof q.TFile)){n.createEl("div",{text:`Error: path is not a file: ${o}`,cls:"note-insight-error"});return}let l=this.analysisService.analyzeNoteByPath(o);if(!l||!l.yearlyData){n.createEl("div",{text:"Error: unable to analyze note",cls:"note-insight-error"});return}let h=this.analysisService.getYearBounds(c),u=n.createEl("div",{cls:"note-insight-code-block yearly"}),m=u.createEl("div",{cls:"yearly-tracker-wrapper"}),f=new Y(this.app,m,C=>this.onYearChanged(i,a,C));f.setYearBounds(h),f.updateData(l.yearlyData,o);let b=s!=null?s:new Date().getFullYear();f.setCurrentYear(b);let k=this.app.metadataCache.on("resolved",W(()=>{let C=this.instances.get(a);if(!C||C.isUpdatingCodeblock)return;let S=this.analysisService.analyzeNoteByPath(o);if(S&&S.yearlyData){let d=this.app.vault.getAbstractFileByPath(o);if(d&&d instanceof q.TFile){let v=this.analysisService.getYearBounds(d);f.setYearBounds(v),f.updateData(S.yearlyData,o)}}},5e3));this.plugin.registerEvent(k),this.instances.set(a,{component:f,codeblockId:a,eventRef:k,type:"yearly",ctx:i,el:n,lastKnownPeriod:b,isUpdatingCodeblock:!1});let D=new q.MarkdownRenderChild(u);D.onunload=()=>{this.cleanupInstance(a)},i.addChild(D)}catch(r){g.error("[YearlyTrackerCodeBlockProcessor] Error:",r);let a="Error rendering yearly tracker";r instanceof Error&&(a=`Error: ${r.message}`),n.createEl("div",{text:a,cls:"note-insight-error"})}}parseConfig(t){let n=this.parseCodeBlockConfig(t),i=n.id,r=n.notePath,a=n.selectedYear;if(!i||!r)return null;let o;if(a){let s=parseInt(a,10);isNaN(s)||(o=s)}return{id:i,notePath:r,selectedYear:o}}onYearChanged(t,n,i){let r=this.instances.get(n);!r||r.isUpdatingCodeblock||r.lastKnownPeriod!==i&&(r.isUpdatingCodeblock=!0,this.updateCodeblockProperty(t,r,"selectedYear",i).catch(()=>{}),setTimeout(()=>{r.isUpdatingCodeblock=!1},100))}};var G=require("obsidian");var oe=class extends B{constructor(t,n,i){super(t,n);this.analysisService=i}register(){this.plugin.registerMarkdownCodeBlockProcessor("note-insight-monthly",this.process.bind(this))}process(t,n,i){try{let r=this.parseConfig(t);if(!r){n.createEl("div",{text:"Error: codeblock ID missing. Please insert codeblock using the context menu.",cls:"note-insight-error"});return}let{id:a,notePath:o,selectedMonth:s}=r;if(!o){n.createEl("div",{text:"Error: note path must be specified",cls:"note-insight-error"});return}let c=this.app.vault.getAbstractFileByPath(o);if(!c){n.createEl("div",{text:`Error: note not found: ${o}`,cls:"note-insight-error"});return}if(!(c instanceof G.TFile)){n.createEl("div",{text:`Error: path is not a file: ${o}`,cls:"note-insight-error"});return}let l,h;if(s){let[d,v]=s.split("-");h=parseInt(d,10),l=parseInt(v,10)-1}else{let d=new Date;l=d.getMonth(),h=d.getFullYear()}let u=this.analysisService.getMonthlyData(c,l,h),m=this.analysisService.getMonthBounds(c),f=n.createEl("div",{cls:"note-insight-code-block monthly"}),b=f.createEl("div",{cls:"monthly-tracker-wrapper"}),k=new A(this.app,b,(d,v)=>this.onMonthChanged(i,a,d,v));k.setMonthBounds(m),k.updateData(u,o),k.setCurrentMonth(l,h);let D=this.app.metadataCache.on("resolved",W(()=>{let d=this.instances.get(a);if(!d||d.isUpdatingCodeblock)return;let v=this.app.vault.getAbstractFileByPath(o);if(v&&v instanceof G.TFile){let{month:P,year:w}=k.getCurrentMonth(),de=this.analysisService.getMonthlyData(v,P,w),N=this.analysisService.getMonthBounds(v);k.setMonthBounds(N),k.updateData(de,o)}},5e3));this.plugin.registerEvent(D);let C=`${h}-${String(l+1).padStart(2,"0")}`;this.instances.set(a,{component:k,codeblockId:a,eventRef:D,type:"monthly",ctx:i,el:n,lastKnownPeriod:C,isUpdatingCodeblock:!1});let S=new G.MarkdownRenderChild(f);S.onunload=()=>{this.cleanupInstance(a)},i.addChild(S)}catch(r){g.error("[MonthlyTrackerCodeBlockProcessor] Error:",r);let a="Error rendering monthly tracker";r instanceof Error&&(a=`Error: ${r.message}`),n.createEl("div",{text:a,cls:"note-insight-error"})}}parseConfig(t){let n=this.parseCodeBlockConfig(t),i=n.id,r=n.notePath,a=n.selectedMonth;return!i||!r?null:{id:i,notePath:r,selectedMonth:a}}onMonthChanged(t,n,i,r){let a=this.instances.get(n);if(!a||a.isUpdatingCodeblock)return;let o=`${r}-${String(i+1).padStart(2,"0")}`;a.lastKnownPeriod!==o&&(a.isUpdatingCodeblock=!0,this.updateCodeblockProperty(t,a,"selectedMonth",o).catch(()=>{}),setTimeout(()=>{a.isUpdatingCodeblock=!1},100))}};var se=class{constructor(e,t){this.app=e,this.plugin=t}register(){this.plugin.registerEvent(this.app.workspace.on("editor-menu",(e,t,n)=>{this.addMenuItems(e,t)}))}addMenuItems(e,t){e.addSeparator(),e.addItem(n=>{n.setTitle("Add yearly tracker from vault").setIcon("bar-chart-3").onClick(()=>{this.showNoteSelectorForYearly(t)})}),e.addItem(n=>{n.setTitle("Add monthly tracker from vault").setIcon("calendar").onClick(()=>{this.showNoteSelectorForMonthly(t)})}),e.addItem(n=>{n.setTitle("Add counter").setIcon("hash").onClick(()=>{this.insertCounterComponent(t)})})}generateCodeblockId(){return Math.random().toString(36).substring(2,8)}showNoteSelectorForYearly(e){new x(this.app,n=>{let r=`\`\`\`note-insight-yearly
id: ${this.generateCodeblockId()}
notePath: ${n.path}
\`\`\`
`;e.replaceSelection(r),this.resizeCanvasNodeIfNeeded(800,300)}).open()}showNoteSelectorForMonthly(e){new x(this.app,n=>{let r=`\`\`\`note-insight-monthly
id: ${this.generateCodeblockId()}
notePath: ${n.path}
\`\`\`
`;e.replaceSelection(r),this.resizeCanvasNodeIfNeeded(420,420)}).open()}insertCounterComponent(e){let n=`\`\`\`note-insight-counter
id: ${this.generateCodeblockId()}
\`\`\`
`;e.replaceSelection(n),this.resizeCanvasNodeIfNeeded(420,410)}resizeCanvasNodeIfNeeded(e,t){var r,a;let n=this.app.workspace.getMostRecentLeaf();if(!n)return;let i=n.view;if(i.getViewType()==="canvas"){let o=i.canvas;if(!o)return;let s=o.selection;if(!s||!s.size||s.size!==1)return;let c=(r=s.values)==null?void 0:r.call(s);if(!c)return;let l=(a=c.next())==null?void 0:a.value;if(!l)return;try{typeof l.moveAndResize=="function"&&l.moveAndResize.call(l,{x:l.x,y:l.y,width:e,height:t})}catch(h){console.error("[NoteInsight] Canvas resizing failed:",h)}}}};var M=require("obsidian");var le=class extends M.PluginSettingTab{constructor(t,n){super(t,n);this.plugin=n}display(){let{containerEl:t}=this;t.empty(),new M.Setting(t).setName("Vault visualizer").setHeading(),new M.Setting(t).setName("First day of week").setDesc("Select the first day of the week for weekly period calculations.").addDropdown(i=>i.addOption("0","Sunday").addOption("1","Monday").addOption("2","Tuesday").addOption("3","Wednesday").addOption("4","Thursday").addOption("5","Friday").addOption("6","Saturday").setValue(String(this.plugin.settings.firstDayOfWeek)).onChange(r=>{this.plugin.settings.firstDayOfWeek=parseInt(r),this.plugin.saveSettings()})),new M.Setting(t).setName("Max watched notes").setDesc("Set the maximum number of notes that can be watched by backlink counter components (no more than 50 recommended).").addText(i=>i.setPlaceholder("50").setValue(String(this.plugin.settings.maxWatchedNotes)).onChange(r=>{let a=parseInt(r);!isNaN(a)&&a>0&&(this.plugin.settings.maxWatchedNotes=a,this.plugin.saveSettings())})),new M.Setting(t).setName("Default series colors").setHeading(),t.createEl("p",{text:"Set default colors for up to 10 series in visualizations.",cls:"setting-item-description"}),new M.Setting(t).setName("Suggested color palette").setDesc("You can also customize individual series colors below by using the color picker.").addDropdown(i=>i.addOption("vibrant","Vibrant").addOption("pastel","Pastel dreamland").setValue(this.plugin.settings.suggestedColorPalette).onChange(r=>{let a=r;this.plugin.settings.suggestedColorPalette=a;let o=ve[a];for(let s=0;s<10;s++){let c=`series${s+1}Color`;this.plugin.settings[c]=o[s]}this.plugin.saveSettings(),this.display()}));for(let i=1;i<=10;i++){let r=`series${i}Color`;new M.Setting(t).setName(`Series ${i} color`).addColorPicker(a=>a.setValue(this.plugin.settings[r]).onChange(o=>{this.plugin.settings[r]=o,this.plugin.saveSettings()}))}new M.Setting(t).setName("Troubleshooting").setHeading(),new M.Setting(t).setName("Reload Obsidian").setDesc("If some changes are not taking effect, you can reload Obsidian to apply them.").addButton(i=>i.setButtonText("Reload Obsidian").onClick(()=>{try{this.app.commands.executeCommandById("app:reload")}catch(r){g.error("Failed to reload Obsidian:",r)}})),new M.Setting(t).setName("Advanced").setHeading();let n=t.createEl("details",{cls:"vault-visualizer-advanced-settings"});n.createEl("summary",{text:"Show advanced settings"}),new M.Setting(n).setName("Log level").setDesc('Set the minimum log level for console output. Lower levels show more messages. Requires reload. You should not need to change this unless you are a developper troubleshooting an issue. Setting this to "Debug", or "Info" may produce a large volume of log messages and impact performance.').addDropdown(i=>i.addOption("0","Debug (all messages)").addOption("1","Info").addOption("2","Warning").addOption("3","Error (default)").addOption("4","None (silent)").setValue(String(this.plugin.settings.logLevel)).onChange(r=>{this.plugin.settings.logLevel=parseInt(r),this.plugin.saveSettings()}))}};var ce=class extends Me.Plugin{async onload(){await this.loadSettings(),g.setLevel(this.settings.logLevel),this.settingsService=new X(this.settings),this.addSettingTab(new le(this.app,this)),this.dailyNoteClassifier=new E(this.app),this.analysisService=new Q(this.app,this.dailyNoteClassifier),this.viewManager=new ie(this.app,this,this.analysisService,this.settingsService),this.viewManager.registerView(),this.backlinkWatcher=new Z(this.app,this,this.analysisService,(t,n,i)=>{this.viewManager.updateNoteInfo(t,n,i)}),this.viewManager.setOnYearChangeCallback(t=>{this.backlinkWatcher.setCurrentYear(t)}),this.viewManager.setOnMonthChangeCallback((t,n)=>{this.backlinkWatcher.setCurrentMonth(t,n)}),this.backlinkWatcher.startWatching(),this.counterProcessor=new re(this.app,this,this.analysisService,this.settingsService),this.counterProcessor.register(),this.yearlyProcessor=new ae(this.app,this,this.analysisService),this.yearlyProcessor.register(),this.monthlyProcessor=new oe(this.app,this,this.analysisService),this.monthlyProcessor.register(),this.contextMenuManager=new se(this.app,this),this.contextMenuManager.register(),this.registerEvent(this.app.workspace.on("quit",()=>{this.backlinkWatcher.stopWatching()}))}onunload(){this.backlinkWatcher&&this.backlinkWatcher.stopWatching(),this.counterProcessor&&this.counterProcessor.unload(),this.yearlyProcessor&&this.yearlyProcessor.unload(),this.monthlyProcessor&&this.monthlyProcessor.unload(),this.viewManager&&this.viewManager.cleanup()}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},me,t)}async saveSettings(){await this.saveData(this.settings),this.settingsService&&this.settingsService.updateSettings(this.settings)}async loadData(){return super.loadData()}};
