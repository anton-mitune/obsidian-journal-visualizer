/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ce=Object.defineProperty;var Se=Object.getOwnPropertyDescriptor;var De=Object.getOwnPropertyNames;var Pe=Object.prototype.hasOwnProperty;var Me=(g,e)=>{for(var t in e)ce(g,t,{get:e[t],enumerable:!0})},Ee=(g,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of De(e))!Pe.call(g,a)&&a!==t&&ce(g,a,{get:()=>e[a],enumerable:!(n=Se(e,a))||n.enumerable});return g};var we=g=>Ee(ce({},"__esModule",{value:!0}),g);var Te={};Me(Te,{default:()=>le});module.exports=we(Te);var be=require("obsidian");var pe={["vibrant"]:["#8b5cf6","#3b82f6","#10b981","#f59e0b","#ef4444","#ec4899","#14b8a6","#f97316","#6366f1","#84cc16"],["pastel"]:["#cdb4db","#ffc8dd","#ffafcc","#bde0fe","#a2d2ff","#9bf6ff","#fdffb6","#caffbf","#9ae6b4","#d0f4de"]},ge={firstDayOfWeek:1,maxWatchedNotes:50,suggestedColorPalette:"vibrant",logLevel:3,series1Color:"#8b5cf6",series2Color:"#3b82f6",series3Color:"#10b981",series4Color:"#f59e0b",series5Color:"#ef4444",series6Color:"#ec4899",series7Color:"#14b8a6",series8Color:"#f97316",series9Color:"#6366f1",series10Color:"#84cc16"},H=(l=>(l.PAST_24_HOURS="past-24-hours",l.PAST_7_DAYS="past-7-days",l.PAST_30_DAYS="past-30-days",l.PAST_90_DAYS="past-90-days",l.PAST_YEAR="past-year",l.TODAY="today",l.THIS_WEEK="this-week",l.THIS_MONTH="this-month",l.THIS_QUARTER="this-quarter",l.THIS_YEAR="this-year",l))(H||{}),K=(a=>(a.DEFAULT="default",a.TOP_N="top-n",a.PIE="pie",a.TIME_SERIES="time-series",a))(K||{}),j=(t=>(t.NOTE="note",t.FOLDER="folder",t))(j||{});var M=class{constructor(e){this.app=e}getDailyNotesFolder(){var t,n,a,i;let e=(i=(a=(n=(t=this.app.internalPlugins)==null?void 0:t.plugins)==null?void 0:n["daily-notes"])==null?void 0:a.instance)==null?void 0:i.options;return(e==null?void 0:e.folder)||""}isDailyNoteFromCurrentMonth(e){let t=this.getDailyNotesFolder();if(t&&!e.path.startsWith(t))return!1;let n=e.basename.match(/(\d{4})-(\d{2})-(\d{2})/);if(!n)return!1;let[,a,i]=n,r=new Date(parseInt(a),parseInt(i)-1),o=new Date,s=o.getFullYear(),c=o.getMonth();return r.getFullYear()===s&&r.getMonth()===c}isDailyNoteFromYear(e,t){let n=this.getDailyNotesFolder();if(n&&!e.path.startsWith(n))return!1;let a=e.basename.match(/(\d{4})-(\d{2})-(\d{2})/);if(!a)return!1;let[,i]=a;return parseInt(i)===t}getYearBounds(e){let t=new Date().getFullYear(),n=new Date().getFullYear();for(let a of e)if(this.isDailyNote(a.file)){let i=this.extractDateFromDailyNote(a.file);if(i){let r=parseInt(i.substring(0,4));t=Math.min(t,r),n=Math.max(n,r)}}return t=Math.max(t-1,2e3),n=Math.min(n+1,new Date().getFullYear()+1),{minYear:t,maxYear:n}}isDailyNote(e){let t=this.getDailyNotesFolder();return t&&!e.path.startsWith(t)?!1:e.basename.match(/(\d{4})-(\d{2})-(\d{2})/)!==null}extractDateFromDailyNote(e){let t=e.basename.match(/(\d{4})-(\d{2})-(\d{2})/);return t?`${t[1]}-${t[2]}-${t[3]}`:null}filterDailyNoteBacklinks(e){return e.filter(t=>this.isDailyNoteFromCurrentMonth(t.file))}countCurrentMonthDailyNoteBacklinks(e){return this.filterDailyNoteBacklinks(e).reduce((n,a)=>n+a.linkCount,0)}getYearlyDailyNoteBacklinks(e,t=new Date().getFullYear()){let n={},a=e.filter(i=>this.isDailyNoteFromYear(i.file,t));for(let i of a){let r=this.extractDateFromDailyNote(i.file);if(r){let o;n[r]={linkCount:i.linkCount,lines:o}}}return n}isDailyNoteFromMonth(e,t,n){let a=this.getDailyNotesFolder();if(a&&!e.path.startsWith(a))return!1;let i=e.basename.match(/(\d{4})-(\d{2})-(\d{2})/);if(!i)return!1;let[,r,o]=i,s=parseInt(r),c=parseInt(o)-1;return s===n&&c===t}findDailyNote(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),i=`${t}-${n}-${a}`,r=this.app.vault.getMarkdownFiles();for(let o of r)if(this.isDailyNote(o)&&this.extractDateFromDailyNote(o)===i)return o;return null}getMonthlyDailyNoteBacklinks(e,t,n){let a={},i=e.filter(r=>this.isDailyNoteFromMonth(r.file,t,n));for(let r of i){let o=this.extractDateFromDailyNote(r.file);o&&(a[o]={linkCount:r.linkCount,lines:void 0})}return a}calculateMonthBounds(e){let t=new Date().getFullYear(),n=new Date().getFullYear(),a=0,i=11,r=new Date;t=r.getFullYear(),n=r.getFullYear(),a=r.getMonth(),i=r.getMonth();let o=!1;for(let s of e)if(this.isDailyNote(s.file)){let c=this.extractDateFromDailyNote(s.file);if(c){let l=new Date(c),d=l.getFullYear(),h=l.getMonth();o?((d<t||d===t&&h<a)&&(t=d,a=h),(d>n||d===n&&h>i)&&(n=d,i=h)):(t=d,n=d,a=h,i=h,o=!0)}}return o?{minMonth:a,minYear:t,maxMonth:i,maxYear:n}:{minYear:r.getFullYear()-1,minMonth:0,maxYear:r.getFullYear()+1,maxMonth:11}}getDailyBacklinksInRange(e,t,n){let a={},i=new Date(t);i.setHours(0,0,0,0);let r=new Date(n);r.setHours(23,59,59,999);for(let o of e)if(this.isDailyNote(o.file)){let s=this.extractDateFromDailyNote(o.file);if(s){let c=new Date(s);c>=i&&c<=r&&(a[s]={linkCount:o.linkCount,lines:void 0})}}return a}};var de=require("obsidian"),J=class{constructor(e,t){this.app=e,this.dailyNoteClassifier=t}getBacklinksForFile(e){let t=[],n=this.app.metadataCache.resolvedLinks;for(let a in n){let i=n[a];if(i&&i[e.path]){let r=this.app.vault.getAbstractFileByPath(a);r instanceof de.TFile&&t.push({file:r,linkCount:i[e.path]})}}return t}analyzeNoteByPath(e,t){let n=this.app.vault.getAbstractFileByPath(e);return n instanceof de.TFile?this.analyzeNote(n,t):null}analyzeNote(e,t){let n=this.getBacklinksForFile(e),a=t!=null?t:new Date().getFullYear(),i=this.dailyNoteClassifier.countCurrentMonthDailyNoteBacklinks(n),r=this.dailyNoteClassifier.getYearlyDailyNoteBacklinks(n,a);return{count:i,noteTitle:e.basename,yearlyData:r}}getYearlyData(e,t){let n=this.getBacklinksForFile(e);return this.dailyNoteClassifier.getYearlyDailyNoteBacklinks(n,t)}getMonthlyData(e,t,n){let a=this.getBacklinksForFile(e);return this.dailyNoteClassifier.getMonthlyDailyNoteBacklinks(a,t,n)}getYearBounds(e){let t=this.getBacklinksForFile(e);return this.dailyNoteClassifier.getYearBounds(t)}getMonthBounds(e){let t=this.getBacklinksForFile(e);return this.dailyNoteClassifier.calculateMonthBounds(t)}getClassifier(){return this.dailyNoteClassifier}};var Q=class{constructor(e){this.listeners=[];this.settings=e}getSettings(){return this.settings}updateSettings(e){this.settings=e,this.notifyListeners()}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}getSeriesColors(){return[this.settings.series1Color,this.settings.series2Color,this.settings.series3Color,this.settings.series4Color,this.settings.series5Color,this.settings.series6Color,this.settings.series7Color,this.settings.series8Color,this.settings.series9Color,this.settings.series10Color]}notifyListeners(){this.listeners.forEach(e=>e(this.settings))}};var X=class{constructor(e,t,n,a){this.currentFile=null;this.currentYear=new Date().getFullYear();this.currentMonth=new Date().getMonth();this.selectedMonthYear=new Date().getFullYear();this.app=e,this.plugin=t,this.analysisService=n,this.onNoteInfoChanged=a,this.boundHandleLeafChange=this.handleLeafChange.bind(this),this.boundHandleFileOpen=this.handleFileOpen.bind(this)}setCurrentYear(e){this.currentYear=e,this.currentFile&&this.updateBacklinkCount(this.currentFile)}setCurrentMonth(e,t){this.currentMonth=e,this.selectedMonthYear=t,this.currentFile&&this.updateBacklinkCount(this.currentFile)}startWatching(){this.plugin.registerEvent(this.app.workspace.on("active-leaf-change",this.boundHandleLeafChange)),this.plugin.registerEvent(this.app.workspace.on("file-open",this.boundHandleFileOpen)),this.updateBacklinkCountForCurrentFile()}stopWatching(){}handleLeafChange(e){this.updateBacklinkCountForCurrentFile()}handleFileOpen(e){e&&e!==this.currentFile&&(this.currentFile=e,this.updateBacklinkCount(e))}updateBacklinkCountForCurrentFile(){let e=this.app.workspace.getActiveFile();e&&e!==this.currentFile&&(this.currentFile=e,this.updateBacklinkCount(e))}updateBacklinkCount(e){let t=this.analysisService.analyzeNote(e,this.currentYear),n=this.analysisService.getYearBounds(e),a=this.analysisService.getMonthBounds(e);this.onNoteInfoChanged(t,n,a)}};var me=require("obsidian");var Y=class{constructor(e,t,n){this.maxIntensity=5;this.watchedNotePath=null;this.app=e,this.container=t,this.yearlyData={},this.onYearChangeCallback=n;let a=new Date().getFullYear();this.navigationState={currentYear:a,minYear:a-10,maxYear:a+1},this.yearBounds={minYear:a-10,maxYear:a+1}}updateData(e,t){this.yearlyData=e,t!==void 0&&(this.watchedNotePath=t),this.render()}setWatchedNotePath(e){this.watchedNotePath=e}setYearBounds(e){this.yearBounds=e,this.navigationState.minYear=e.minYear,this.navigationState.maxYear=e.maxYear,this.navigationState.currentYear<e.minYear?this.navigationState.currentYear=e.minYear:this.navigationState.currentYear>e.maxYear&&(this.navigationState.currentYear=e.maxYear),this.render()}setCurrentYear(e){e<this.yearBounds.minYear||e>this.yearBounds.maxYear||(this.navigationState.currentYear=e,this.render(),this.onYearChangeCallback&&this.onYearChangeCallback(e))}getCurrentYear(){return this.navigationState.currentYear}clear(){this.yearlyData={},this.render()}render(){this.container.empty();let e=this.container.createEl("div",{cls:"yearly-tracker-container"});this.watchedNotePath&&this.createNoteHeader(e),this.createHeader(e);let t=e.createEl("div",{cls:"yearly-tracker-grid"}),n=this.navigationState.currentYear,a=this.generateYearDays(n);this.createMonthLabels(t,n);let i=t.createEl("div",{cls:"yearly-tracker-days"});this.createWeekdayLabels(i),this.createDaySquares(i,a),this.createLegend(e)}createNoteHeader(e){var i,r;let t=e.createEl("div",{cls:"yearly-tracker-note-header"}),n=((r=(i=this.watchedNotePath)==null?void 0:i.split("/").pop())==null?void 0:r.replace(".md",""))||"Unknown Note";t.createEl("h4",{text:n,cls:"yearly-tracker-note-title"}).addEventListener("click",async()=>{if(this.watchedNotePath){let o=this.app.vault.getAbstractFileByPath(this.watchedNotePath);o&&await this.app.workspace.getLeaf(!1).openFile(o)}})}createHeader(e){let t=e.createEl("div",{cls:"yearly-tracker-header"});t.createEl("div",{text:"Daily note backlinks",cls:"yearly-tracker-title"});let n=t.createEl("div",{cls:"yearly-tracker-year-nav"}),a=n.createEl("button",{text:"\u2039",cls:"yearly-tracker-year-btn yearly-tracker-year-prev"});a.disabled=this.navigationState.currentYear<=this.yearBounds.minYear,a.addEventListener("click",()=>{this.navigationState.currentYear>this.yearBounds.minYear&&this.setCurrentYear(this.navigationState.currentYear-1)});let i=n.createEl("span",{text:this.navigationState.currentYear.toString(),cls:"yearly-tracker-current-year"}),r=n.createEl("button",{text:"\u203A",cls:"yearly-tracker-year-btn yearly-tracker-year-next"});r.disabled=this.navigationState.currentYear>=this.yearBounds.maxYear,r.addEventListener("click",()=>{this.navigationState.currentYear<this.yearBounds.maxYear&&this.setCurrentYear(this.navigationState.currentYear+1)})}generateYearDays(e){let t=[],n=new Date(e,0,1),a=new Date(e,11,31);for(let i=new Date(n);i<=a;i.setDate(i.getDate()+1))t.push(new Date(i));return t}createMonthLabels(e,t){let n=e.createEl("div",{cls:"yearly-tracker-months"});["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].forEach(i=>{n.createEl("div",{text:i,cls:"yearly-tracker-month-label"})})}createWeekdayLabels(e){let t=e.createEl("div",{cls:"yearly-tracker-weekdays"});["","Mon","","Wed","","Fri",""].forEach(a=>{t.createEl("div",{text:a,cls:"yearly-tracker-weekday-label"})})}createDaySquares(e,t){let n=e.createEl("div",{cls:"yearly-tracker-squares"}),r=(t[0].getDay()+6)%7;for(let o=0;o<r;o++)n.createEl("div",{cls:"yearly-tracker-square yearly-tracker-square-empty"});t.forEach(o=>{let s=this.formatDateString(o),c=this.yearlyData[s]||{linkCount:0},l=this.calculateIntensity(c.linkCount),d=n.createEl("div",{cls:`yearly-tracker-square yearly-tracker-square-intensity-${l}`});this.addTooltip(d,o,c)})}createLegend(e){let t=e.createEl("div",{cls:"yearly-tracker-legend"});t.createEl("span",{text:"Less",cls:"yearly-tracker-legend-label"});for(let n=0;n<=4;n++)t.createEl("div",{cls:`yearly-tracker-square yearly-tracker-square-intensity-${n} yearly-tracker-legend-square`});t.createEl("span",{text:"More",cls:"yearly-tracker-legend-label"})}formatDateString(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${a}`}calculateIntensity(e){return e===0?0:e===1?1:e===2?2:e<=4?3:4}addTooltip(e,t,n){let a=t.toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric"}),i;n.linkCount===0?i=`No backlinks on ${a}`:i=`${n.linkCount} backlink${n.linkCount>1?"s":""} on ${a}`,e.setAttribute("aria-label",i),n.linkCount>0&&(e.addClass("yearly-tracker-square-clickable"),e.addEventListener("click",async()=>{await this.openDailyNote(t)}))}async openDailyNote(e){let n=new M(this.app).findDailyNote(e);n&&await this.app.workspace.getLeaf(!1).openFile(n)}};var A=class{constructor(e,t,n){this.maxIntensity=5;this.watchedNotePath=null;this.app=e,this.container=t,this.yearlyData={},this.onMonthChangeCallback=n;let a=new Date,i=a.getMonth(),r=a.getFullYear();this.navigationState={currentMonth:i,currentYear:r,minMonth:i,minYear:r-10,maxMonth:i,maxYear:r+1},this.monthBounds={minMonth:i,minYear:r-10,maxMonth:i,maxYear:r+1}}updateData(e,t){this.yearlyData=e,t!==void 0&&(this.watchedNotePath=t),this.render()}setWatchedNotePath(e){this.watchedNotePath=e}setMonthBounds(e){this.monthBounds=e,this.navigationState.minMonth=e.minMonth,this.navigationState.minYear=e.minYear,this.navigationState.maxMonth=e.maxMonth,this.navigationState.maxYear=e.maxYear,this.isMonthBefore(this.navigationState.currentMonth,this.navigationState.currentYear,e.minMonth,e.minYear)?(this.navigationState.currentMonth=e.minMonth,this.navigationState.currentYear=e.minYear):this.isMonthAfter(this.navigationState.currentMonth,this.navigationState.currentYear,e.maxMonth,e.maxYear)&&(this.navigationState.currentMonth=e.maxMonth,this.navigationState.currentYear=e.maxYear),this.render()}setCurrentMonth(e,t){this.isMonthBefore(e,t,this.monthBounds.minMonth,this.monthBounds.minYear)||this.isMonthAfter(e,t,this.monthBounds.maxMonth,this.monthBounds.maxYear)||(this.navigationState.currentMonth=e,this.navigationState.currentYear=t,this.render(),this.onMonthChangeCallback&&this.onMonthChangeCallback(e,t))}getCurrentMonth(){return{month:this.navigationState.currentMonth,year:this.navigationState.currentYear}}goToPreviousMonth(){let e=this.navigationState.currentMonth-1,t=this.navigationState.currentYear;e<0&&(e=11,t--),this.setCurrentMonth(e,t)}goToNextMonth(){let e=this.navigationState.currentMonth+1,t=this.navigationState.currentYear;e>11&&(e=0,t++),this.setCurrentMonth(e,t)}isMonthBefore(e,t,n,a){return t<a||t===a&&e<n}isMonthAfter(e,t,n,a){return t>a||t===a&&e>n}clear(){this.yearlyData={},this.render()}render(){this.container.empty();let e=this.container.createEl("div",{cls:"monthly-tracker-container"});this.watchedNotePath&&this.createNoteHeader(e),this.createHeader(e);let t=e.createEl("div",{cls:"monthly-tracker-grid"}),n=this.generateMonthDays(this.navigationState.currentMonth,this.navigationState.currentYear);this.createWeekdayHeaders(t);let a=t.createEl("div",{cls:"monthly-tracker-days"});this.createDaySquares(a,n),this.createLegend(e)}createNoteHeader(e){var i,r;let t=e.createEl("div",{cls:"monthly-tracker-note-header"}),n=((r=(i=this.watchedNotePath)==null?void 0:i.split("/").pop())==null?void 0:r.replace(".md",""))||"Unknown Note";t.createEl("h4",{text:n,cls:"monthly-tracker-note-title"}).addEventListener("click",async()=>{if(this.watchedNotePath){let o=this.app.vault.getAbstractFileByPath(this.watchedNotePath);o&&await this.app.workspace.getLeaf(!1).openFile(o)}})}createHeader(e){let t=e.createEl("div",{cls:"monthly-tracker-header"}),n=new Date(this.navigationState.currentYear,this.navigationState.currentMonth),a=n.toLocaleDateString("en-GB",{month:"long",year:"numeric"});t.createEl("div",{text:`${a} backlinks`,cls:"monthly-tracker-title"});let i=t.createEl("div",{cls:"monthly-tracker-month-nav"}),r=i.createEl("button",{text:"\u2039",cls:"monthly-tracker-month-btn monthly-tracker-month-prev"}),o=this.navigationState.currentMonth-1,s=this.navigationState.currentYear;o<0&&(o=11,s--),r.disabled=this.isMonthBefore(o,s,this.monthBounds.minMonth,this.monthBounds.minYear),r.addEventListener("click",()=>{this.goToPreviousMonth()});let c=i.createEl("span",{text:n.toLocaleDateString("en-GB",{month:"short",year:"numeric"}),cls:"monthly-tracker-current-month"}),l=i.createEl("button",{text:"\u203A",cls:"monthly-tracker-month-btn monthly-tracker-month-next"}),d=this.navigationState.currentMonth+1,h=this.navigationState.currentYear;d>11&&(d=0,h++),l.disabled=this.isMonthAfter(d,h,this.monthBounds.maxMonth,this.monthBounds.maxYear),l.addEventListener("click",()=>{this.goToNextMonth()})}generateMonthDays(e,t){let n=[],a=new Date(t,e,1),i=new Date(t,e+1,0);for(let r=new Date(a);r<=i;r.setDate(r.getDate()+1))n.push(new Date(r));return n}generateCurrentMonthDays(){let e=new Date;return this.generateMonthDays(e.getMonth(),e.getFullYear())}createWeekdayHeaders(e){let t=e.createEl("div",{cls:"monthly-tracker-weekdays"});["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(a=>{t.createEl("div",{text:a,cls:"monthly-tracker-weekday-label"})})}createDaySquares(e,t){let n=e.createEl("div",{cls:"monthly-tracker-squares"}),r=(t[0].getDay()+6)%7;for(let c=0;c<r;c++)n.createEl("div",{cls:"monthly-tracker-square monthly-tracker-square-empty"});t.forEach(c=>{let l=this.formatDateString(c),d=this.yearlyData[l]||{linkCount:0},h=this.calculateIntensity(d.linkCount),m=n.createEl("div",{cls:`monthly-tracker-square monthly-tracker-square-intensity-${h}`});m.createEl("span",{text:c.getDate().toString(),cls:"monthly-tracker-square-day"}),this.addTooltip(m,c,d)});let o=n.children.length,s=42;for(let c=o;c<s;c++)n.createEl("div",{cls:"monthly-tracker-square monthly-tracker-square-empty"})}createLegend(e){let t=e.createEl("div",{cls:"monthly-tracker-legend"});t.createEl("span",{text:"Less",cls:"monthly-tracker-legend-label"});for(let n=0;n<=4;n++)t.createEl("div",{cls:`monthly-tracker-square monthly-tracker-square-intensity-${n} monthly-tracker-legend-square`});t.createEl("span",{text:"More",cls:"monthly-tracker-legend-label"})}formatDateString(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${a}`}calculateIntensity(e){return e===0?0:e===1?1:e===2?2:e<=4?3:4}addTooltip(e,t,n){let a=t.toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric"}),i;n.linkCount===0?i=`No backlinks on ${a}`:i=`${n.linkCount} backlink${n.linkCount>1?"s":""} on ${a}`,e.setAttribute("aria-label",i),n.linkCount>0&&(e.addClass("monthly-tracker-square-clickable"),e.addEventListener("click",async()=>{await this.openDailyNote(t)}))}async openDailyNote(e){let n=new M(this.app).findDailyNote(e);n&&await this.app.workspace.getLeaf(!1).openFile(n)}};var E=require("obsidian");var y=class{static calculateDateRange(e,t=1){let n=new Date,a,i;switch(e){case"past-24-hours":a=new Date(n.getTime()-24*60*60*1e3),i=new Date(n);break;case"past-7-days":a=new Date(n.getFullYear(),n.getMonth(),n.getDate()-6,0,0,0,0),i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);break;case"past-30-days":a=new Date(n.getFullYear(),n.getMonth(),n.getDate()-29,0,0,0,0),i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);break;case"past-90-days":a=new Date(n.getFullYear(),n.getMonth(),n.getDate()-89,0,0,0,0),i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);break;case"past-year":a=new Date(n.getFullYear(),n.getMonth(),n.getDate()-364,0,0,0,0),i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);break;case"today":a=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);break;case"this-week":{let s=t,l=(n.getDay()-s+7)%7,d=n.getFullYear(),h=n.getMonth(),m=n.getDate();a=new Date(d,h,m-l,0,0,0,0),i=new Date(d,h,m-l+6,23,59,59,999);break}case"this-month":a=new Date(n.getFullYear(),n.getMonth(),1,0,0,0,0),i=new Date(n.getFullYear(),n.getMonth()+1,0,23,59,59,999);break;case"this-quarter":let o=Math.floor(n.getMonth()/3)*3;a=new Date(n.getFullYear(),o,1,0,0,0,0),i=new Date(n.getFullYear(),o+3,0,23,59,59,999);break;case"this-year":a=new Date(n.getFullYear(),0,1,0,0,0,0),i=new Date(n.getFullYear(),11,31,23,59,59,999);break;default:a=new Date(n.getTime()-30*24*60*60*1e3),i=new Date(n)}return{startDate:a,endDate:i}}static getPeriodLabel(e){switch(e){case"past-24-hours":return"past 24 hours";case"past-7-days":return"past 7 days";case"past-30-days":return"past 30 days";case"past-90-days":return"past 90 days";case"past-year":return"past year";case"today":return"today";case"this-week":return"this week";case"this-month":return"this month";case"this-quarter":return"this quarter";case"this-year":return"this year";default:return"past 30 days"}}static getAllPeriods(){return[{value:"past-24-hours",label:y.getPeriodLabel("past-24-hours")},{value:"past-7-days",label:y.getPeriodLabel("past-7-days")},{value:"past-30-days",label:y.getPeriodLabel("past-30-days")},{value:"past-90-days",label:y.getPeriodLabel("past-90-days")},{value:"past-year",label:y.getPeriodLabel("past-year")},{value:"today",label:y.getPeriodLabel("today")},{value:"this-week",label:y.getPeriodLabel("this-week")},{value:"this-month",label:y.getPeriodLabel("this-month")},{value:"this-quarter",label:y.getPeriodLabel("this-quarter")},{value:"this-year",label:y.getPeriodLabel("this-year")}]}};var I=require("obsidian");var he=class{constructor(){this.prefix="[Vault Visualizer]";this.level=1}setLevel(e){this.level=e}getLevel(){return this.level}debug(e,...t){this.level<=0&&console.log(`${this.prefix} [DEBUG]`,e,...t)}info(e,...t){this.level<=1&&console.log(`${this.prefix} [INFO]`,e,...t)}warn(e,...t){this.level<=2&&console.warn(`${this.prefix} [WARN]`,e,...t)}error(e,...t){this.level<=3&&console.error(`${this.prefix} [ERROR]`,e,...t)}log(e,...t){this.level<=1&&console.log(`${this.prefix}`,e,...t)}},f=new he;var Z=class{constructor(e){this.app=e}getNotesInFolder(e,t=!0){if(!e||typeof e!="string")return f.warn("[FolderResolver] Invalid folder path:",e),[];let n=e.trim().replace(/^\/+|\/+$/g,""),a=this.app.vault.getAbstractFileByPath(n);if(!a)return f.warn("[FolderResolver] Folder not found:",n),[];if(!(a instanceof I.TFolder))return f.warn("[FolderResolver] Path is not a folder:",n),[];let i=[];if(t)this.collectNotesRecursive(a,i);else for(let r of a.children)r instanceof I.TFile&&r.extension==="md"&&i.push(r);return i}collectNotesRecursive(e,t){for(let n of e.children)n instanceof I.TFile&&n.extension==="md"?t.push(n):n instanceof I.TFolder&&this.collectNotesRecursive(n,t)}};var fe=require("obsidian"),B=class extends fe.SuggestModal{constructor(t,n){super(t);this.onSelect=n,this.files=this.app.vault.getMarkdownFiles(),this.setPlaceholder("Select a note...")}getSuggestions(t){let n=t.toLowerCase();return this.files.filter(a=>{let i=a.basename.toLowerCase(),r=a.path.toLowerCase();return i.includes(n)||r.includes(n)})}renderSuggestion(t,n){n.createEl("div",{text:t.basename}),n.createEl("small",{text:t.path,cls:"note-selector-path"})}onChooseSuggestion(t,n){this.onSelect(t)}};var L=require("obsidian"),ee=class extends L.SuggestModal{constructor(t,n){super(t);this.onSelect=n,this.folders=this.getAllFolders().filter(a=>a.path!=="/"),this.setPlaceholder("Select a folder to watch...")}getAllFolders(){let t=[],n=i=>{t.push(i),i.children.forEach(r=>{r instanceof L.TFolder&&n(r)})},a=this.app.vault.getRoot();return a instanceof L.TFolder&&a.children.forEach(i=>{i instanceof L.TFolder&&n(i)}),t}getSuggestions(t){if(t==="")return this.folders;let n=t.toLowerCase();return this.folders.filter(a=>{let i=a.name.toLowerCase(),r=a.path.toLowerCase();return i.includes(n)||r.includes(n)})}renderSuggestion(t,n){n.createEl("div",{text:t.name}),n.createEl("small",{text:t.path,cls:"folder-selector-path"})}onChooseSuggestion(t,n){this.onSelect(t)}};var _=class{constructor(e){this.container=e}render(e,t){if(this.container.empty(),e.length===0){this.renderEmptyState();return}let n=this.sortResults(e),a=this.container.createEl("canvas",{cls:"top-n-chart-canvas"});this.renderPlaceholder(n,t)}sortResults(e){return[...e].sort((t,n)=>t.count!==n.count?n.count-t.count:t.noteTitle.localeCompare(n.noteTitle))}renderPlaceholder(e,t){this.container.empty();let n=this.container.createEl("div",{cls:"top-n-placeholder"});n.createEl("h4",{text:`Top ${e.length} Notes by Backlinks (${t})`,cls:"top-n-title"});let a=n.createEl("div",{cls:"top-n-chart-placeholder"}),i=Math.max(...e.map(r=>r.count));e.forEach((r,o)=>{let s=a.createEl("div",{cls:"top-n-bar-container"}),c=this.truncateTitle(r.noteTitle,25);s.createEl("div",{text:c,cls:"top-n-bar-label",attr:{title:r.noteTitle}});let l=s.createEl("div",{cls:"top-n-bar-wrapper"}),d=i>0?r.count/i*100:0,h=l.createEl("div",{cls:"top-n-bar",attr:{style:`width: ${d}%`,"data-count":r.count.toString()}});s.createEl("div",{text:r.count.toString(),cls:"top-n-bar-count"})})}renderEmptyState(){this.container.createEl("div",{text:"\u{1F4CA} No data available for top-N visualization",cls:"top-n-empty-state"})}truncateTitle(e,t){return e.length<=t?e:e.substring(0,t-3)+"..."}destroy(){this.chart&&(this.chart.destroy(),this.chart=null)}};var V=class{constructor(e){this.container=e}render(e,t,n){if(this.container.empty(),e.length===0){this.renderEmptyState();return}let a=this.sortResults(e),i=this.container.createEl("canvas",{cls:"pie-chart-canvas"});this.renderPlaceholder(a,t,n)}sortResults(e){return[...e].sort((t,n)=>t.count!==n.count?n.count-t.count:t.noteTitle.localeCompare(n.noteTitle))}renderPlaceholder(e,t,n){this.container.empty();let a=this.container.createEl("div",{cls:"pie-placeholder"});a.createEl("h4",{text:`Backlink Distribution (${t})`,cls:"pie-title"});let i=a.createEl("div",{cls:"pie-chart-wrapper"}),r=e.reduce((v,C)=>v+C.count,0),s=i.createEl("div",{cls:"pie-chart-container"}).createEl("div",{cls:"pie-chart-visual"}),c=[],l=0,h=n||["#8b5cf6","#3b82f6","#10b981","#f59e0b","#ef4444","#ec4899","#14b8a6","#f97316"];e.forEach((v,C)=>{let D=(r>0?v.count/r*100:0)/100*360,b=h[C%h.length],S=l,u=l+D;C===0?c.push(`${b} 0deg ${u}deg`):c.push(`${b} ${S}deg ${u}deg`),l=u}),s.style.background=`conic-gradient(from -90deg, ${c.join(", ")})`;let m=i.createEl("div",{cls:"pie-legend"});e.forEach((v,C)=>{let k=m.createEl("div",{cls:"pie-legend-item"}),D=k.createEl("div",{cls:"pie-legend-color"});D.style.backgroundColor=h[C%h.length];let b=k.createEl("div",{cls:"pie-legend-text"}),S=this.truncateTitle(v.noteTitle,30),u=r>0?(v.count/r*100).toFixed(1):0;b.createEl("span",{text:S,cls:"pie-legend-label",attr:{title:v.noteTitle}}),b.createEl("span",{text:`${v.count} (${u}%)`,cls:"pie-legend-count"})})}renderEmptyState(){this.container.createEl("div",{text:"\u{1F4CA} No data available for pie visualization",cls:"pie-empty-state"})}truncateTitle(e,t){return e.length<=t?e:e.substring(0,t-3)+"..."}destroy(){this.chart&&(this.chart.destroy(),this.chart=null)}};var U=class{constructor(e){this.container=e}render(e,t){if(this.container.empty(),e.length===0||e.every(i=>i.dataPoints.length===0)){this.renderEmptyState();return}let n=this.container.createEl("div",{cls:"time-series-container"});n.createEl("h4",{text:`Backlink Evolution (${t})`,cls:"time-series-title"});let a=n.createEl("div",{cls:"time-series-chart-wrapper"});this.renderChart(a,e),this.renderLegend(n,e)}renderChart(e,t){let i={top:20,right:20,bottom:40,left:50},r=600-i.left-i.right,o=300-i.top-i.bottom,s=e.createSvg("svg",{attr:{width:"100%",height:300 .toString(),viewBox:`0 0 ${600} ${300}`,cls:"time-series-svg"}}),c=new Set;t.forEach(u=>{u.dataPoints.forEach(p=>c.add(p.date))});let l=Array.from(c).sort();if(l.length===0)return;let d=0;t.forEach(u=>{u.dataPoints.forEach(p=>{p.count>d&&(d=p.count)})});let h=Math.max(d+1,5),m=u=>i.left+u/Math.max(l.length-1,1)*r,v=u=>i.top+o-u/h*o,C=s.createSvg("g",{attr:{cls:"time-series-grid"}});for(let u=0;u<=5;u++){let p=v(u/5*h);C.createSvg("line",{attr:{x1:i.left.toString(),y1:p.toString(),x2:(i.left+r).toString(),y2:p.toString(),stroke:"var(--background-modifier-border)","stroke-width":"1","stroke-dasharray":"2,2"}})}let k=s.createSvg("g",{attr:{cls:"time-series-axes"}});k.createSvg("line",{attr:{x1:i.left.toString(),y1:i.top.toString(),x2:i.left.toString(),y2:(i.top+o).toString(),stroke:"var(--text-muted)","stroke-width":"2"}}),k.createSvg("line",{attr:{x1:i.left.toString(),y1:(i.top+o).toString(),x2:(i.left+r).toString(),y2:(i.top+o).toString(),stroke:"var(--text-muted)","stroke-width":"2"}});let D=s.createSvg("g",{attr:{cls:"time-series-labels"}});for(let u=0;u<=5;u++){let p=Math.round(u/5*h),P=v(p);D.createSvg("text",{attr:{x:(i.left-10).toString(),y:P.toString(),"text-anchor":"end","dominant-baseline":"middle",fill:"var(--text-muted)","font-size":"12"}}).textContent=p.toString()}let b=Math.max(1,Math.floor(l.length/7));l.forEach((u,p)=>{if(p%b===0||p===l.length-1){let P=m(p),T=this.formatDateLabel(u);D.createSvg("text",{attr:{x:P.toString(),y:(i.top+o+20).toString(),"text-anchor":"middle",fill:"var(--text-muted)","font-size":"11"}}).textContent=T}});let S=s.createSvg("g",{attr:{cls:"time-series-lines"}});t.forEach((u,p)=>{let P=new Map;u.dataPoints.forEach(N=>{P.set(N.date,N.count)});let T="";l.forEach((N,z)=>{let $=P.get(N)||0,q=m(z),G=v($);z===0?T+=`M ${q} ${G}`:T+=` L ${q} ${G}`}),S.createSvg("path",{attr:{d:T,fill:"none",stroke:u.color,"stroke-width":"2","stroke-linejoin":"round","stroke-linecap":"round"}});let F=S.createSvg("g",{attr:{cls:"time-series-points"}});l.forEach((N,z)=>{let $=P.get(N);if($!==void 0&&$>0){let q=m(z),G=v($);F.createSvg("circle",{attr:{cx:q.toString(),cy:G.toString(),r:"4",fill:u.color,stroke:"var(--background-primary)","stroke-width":"2"}})}})})}renderLegend(e,t){let n=e.createEl("div",{cls:"time-series-legend"});t.forEach(a=>{let i=n.createEl("div",{cls:"time-series-legend-item"}),r=i.createEl("div",{cls:"time-series-legend-color"});r.style.backgroundColor=a.color;let o=this.truncateTitle(a.noteTitle,30);i.createEl("span",{text:o,cls:"time-series-legend-label",attr:{title:a.noteTitle}})})}formatDateLabel(e){let t=e.split("-");if(t.length===3){let n=parseInt(t[1]),a=parseInt(t[2]);return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n-1]} ${a}`}return e}renderEmptyState(){this.container.createEl("div",{text:"\u{1F4CA} No data available for time-series visualization",cls:"time-series-empty-state"})}truncateTitle(e,t){return e.length<=t?e:e.substring(0,t-3)+"..."}destroy(){}};function ve(g,e){return g.map((t,n)=>{let a=[];for(let[i,r]of Object.entries(t.data))a.push({date:i,count:r.linkCount});return a.sort((i,r)=>i.date.localeCompare(r.date)),{noteTitle:t.noteTitle,notePath:t.notePath,dataPoints:a,color:e[n%e.length]}})}var R=class{constructor(e,t,n,a,i,r,o,s,c,l,d,h){this.counterResults=[];this.container=e,this.app=t,this.classifier=n,this.analysisService=a,this.settingsService=i,this.folderResolver=new Z(t),this.onPeriodChangeCallback=r,this.onNoteAddedCallback=o,this.onNoteRemovedCallback=s,this.onDisplayModeChangeCallback=c,this.onModeChangeCallback=l,this.onFolderAddedCallback=d,this.onFolderRemovedCallback=h,this.state={selectedPeriod:"past-30-days",displayAs:"default",watchMode:"folder"},this.topNRenderer=new _(this.container),this.pieRenderer=new V(this.container),this.timeSeriesRenderer=new U(this.container),this.unsubscribeSettings=this.settingsService.subscribe(()=>{this.updateCounts(),this.render()})}cleanup(){this.unsubscribeSettings&&this.unsubscribeSettings()}updateWatchedItems(e){this.state.notePath=e.notePath,e.displayAs!==void 0&&(this.state.displayAs=e.displayAs),e.watchMode!==void 0&&(this.state.watchMode=e.watchMode),e.folderPath!==void 0&&(this.state.folderPath=e.folderPath),this.updateCounts(),this.render()}updateData(e,t,n){n&&(this.state.notePath=[n]);let a=this.calculateCountForBacklinks(e);this.counterResults=[{notePath:n||"",noteTitle:t||"Unknown",count:a}],this.render()}setSelectedPeriod(e){this.state.selectedPeriod=e,this.updateCounts(),this.render()}setDisplayMode(e){this.state.displayAs=e,this.render()}clear(){this.counterResults=[],this.container.empty()}addNote(e){this.onNoteAddedCallback&&this.onNoteAddedCallback(e)}removeNote(e){this.onNoteRemovedCallback&&this.onNoteRemovedCallback(e)}changeWatchMode(e){this.onModeChangeCallback&&this.onModeChangeCallback(e)}addFolder(e){this.onFolderAddedCallback&&this.onFolderAddedCallback(e)}removeFolder(){this.onFolderRemovedCallback&&this.onFolderRemovedCallback()}isEmpty(){let e=this.state.notePath&&this.state.notePath.length>0,t=this.state.folderPath&&this.state.folderPath.length>0;return!e&&!t}isModeToggleEnabled(){return this.isEmpty()}updateCounts(){if(this.counterResults=[],(this.state.watchMode||"folder")==="folder"){if(this.state.folderPath&&this.state.folderPath.length>0){let t=this.state.folderPath[0],n=this.folderResolver.getNotesInFolder(t);for(let a of n){let i=this.analysisService.getBacklinksForFile(a),r=this.calculateCountForBacklinks(i);this.counterResults.push({notePath:a.path,noteTitle:a.basename,count:r})}f.log("[BacklinkCounter] Folder mode - found",n.length,"notes in",t)}}else if(this.state.notePath&&this.state.notePath.length>0){typeof this.state.notePath=="string"&&(this.state.notePath=[this.state.notePath]);for(let t of this.state.notePath){let n=this.app.vault.getAbstractFileByPath(t);if(n instanceof E.TFile){let a=this.analysisService.getBacklinksForFile(n);f.warn("[BacklinkCounter] Calculating count for note:",n.path,a);let i=this.calculateCountForBacklinks(a);this.counterResults.push({notePath:n.path,noteTitle:n.basename,count:i})}}}}calculateCountForBacklinks(e){if(e.length===0)return 0;let t=this.settingsService.getSettings().firstDayOfWeek,n=y.calculateDateRange(this.state.selectedPeriod,t),a=0;f.log("[BacklinkCounter] Date range:",{period:this.state.selectedPeriod,startDate:n.startDate.toISOString(),endDate:n.endDate.toISOString()});for(let i of e)if(this.classifier.isDailyNote(i.file)){let r=this.classifier.extractDateFromDailyNote(i.file);if(r){let o=this.parseDateString(r);if(o){let s=o>=n.startDate&&o<=n.endDate;f.log("[BacklinkCounter] Checking daily note:",{file:i.file.path,dateString:r,fileDate:o.toISOString(),isInRange:s,linkCount:i.linkCount}),s&&(a+=i.linkCount)}}}return f.log("[BacklinkCounter] Final count:",a),a}parseDateString(e){let t=e.match(/(\d{4})-(\d{2})-(\d{2})/);if(!t)return null;let[,n,a,i]=t;return new Date(parseInt(n),parseInt(a)-1,parseInt(i),0,0,0,0)}onPeriodChange(e){this.state.selectedPeriod=e,this.updateCounts(),this.render(),this.onPeriodChangeCallback&&this.onPeriodChangeCallback(e)}onDisplayModeChange(e){this.state.displayAs=e,this.render(),this.onDisplayModeChangeCallback&&this.onDisplayModeChangeCallback(e)}render(){this.container.empty(),this.container.addClass("backlink-counter-component"),this.renderControls();let e=this.state.displayAs||"default";e==="top-n"?this.renderTopNMode():e==="pie"?this.renderPieMode():e==="time-series"?this.renderTimeSeriesMode():this.renderDefaultMode()}renderModeToggle(e){if(!this.onModeChangeCallback)return;let t=e.createEl("div",{cls:"watch-mode-toggle-container"}),n=this.state.watchMode||"folder",a=this.isModeToggleEnabled(),i=t.createEl("div",{cls:`watch-mode-toggle ${a?"enabled":"disabled"}`}),r=i.createEl("button",{cls:`watch-mode-option ${n==="folder"?"active":""}`,text:"Folder",attr:{"aria-label":"Watch folder mode",disabled:a?null:"true"}}),o=i.createEl("button",{cls:`watch-mode-option ${n==="note"?"active":""}`,text:"Note",attr:{"aria-label":"Watch note mode",disabled:a?null:"true"}});a&&(r.addEventListener("click",()=>{n!=="folder"&&this.changeWatchMode("folder")}),o.addEventListener("click",()=>{n!=="note"&&this.changeWatchMode("note")}))}renderControls(){var o;let e=this.container.createEl("div",{cls:"backlink-counter-controls"});if(this.renderModeToggle(e),this.shouldShowDisplayModeToggle()){let s=this.state.displayAs||"default",c=e.createEl("button",{cls:"backlink-counter-mode-toggle",attr:{"aria-label":this.getDisplayModeLabel(s)}});(0,E.setIcon)(c,this.getDisplayModeIcon(s)),c.addEventListener("click",()=>{let l=this.getNextDisplayMode(s);this.onDisplayModeChange(l)})}let t=e.createEl("select",{cls:"backlink-counter-dropdown"});y.getAllPeriods().forEach(s=>{let c=t.createEl("option",{text:s.label,value:s.value});s.value===this.state.selectedPeriod&&(c.selected=!0)}),t.addEventListener("change",()=>{this.onPeriodChange(t.value)});let a=this.state.watchMode||"folder",i=this.onFolderAddedCallback,r=this.onNoteAddedCallback;if(a==="folder"&&i||a==="note"&&r){let s=((o=this.state.notePath)==null?void 0:o.length)||0,c=this.settingsService.getSettings().maxWatchedNotes,l=a==="folder",d=this.state.folderPath&&this.state.folderPath.length>0,h=l?d:s>=c,m=e.createEl("button",{cls:`backlink-counter-add-button ${h?"disabled":""}`,attr:{"aria-label":h?l?"A folder is already selected":`Maximum limit of ${c} notes reached`:l?"Add folder to watch":"Add note to watch"}}),v=" +";m.textContent=v,(0,E.setIcon)(m,l?"folder-plus":"plus"),h?m.disabled=!0:m.addEventListener("click",()=>{l?this.showFolderSelector():this.showNoteSelector()})}}shouldShowDisplayModeToggle(){return this.counterResults.length>1}renderDefaultMode(){if(this.counterResults.length===0)this.renderEmptyState();else{let e=this.state.watchMode||"folder";if(e==="folder"&&this.state.folderPath&&this.state.folderPath.length>0&&this.renderFolderHeader(),this.counterResults.length===1&&e==="note"){let t=this.counterResults[0],n=this.container.createEl("div",{cls:"backlink-counter-display"}),a=n.createEl("div",{cls:"backlink-counter-number",text:t.count.toString()}),i=n.createEl("div",{cls:"backlink-counter-label",text:this.getCountLabel(t.count)})}else{let t=this.container.createEl("div",{cls:"backlink-counter-list"});this.counterResults.sort((o,s)=>s.count-o.count);let n=this.settingsService.getSettings().maxWatchedNotes,a=this.counterResults.slice(0,n),i=this.counterResults.length,r=i>n;for(let o of a){let s=t.createEl("div",{cls:"backlink-counter-item"}),c=s.createEl("div",{cls:"backlink-counter-item-title",text:o.noteTitle}),l=s.createEl("div",{cls:"backlink-counter-item-count",text:`${o.count} ${o.count===1?"backlink":"backlinks"}`});if(this.onNoteRemovedCallback&&e==="note"){let d=s.createEl("button",{cls:"backlink-counter-item-remove",attr:{"aria-label":`Remove ${o.noteTitle}`}});(0,E.setIcon)(d,"x"),d.addEventListener("click",h=>{h.stopPropagation(),this.removeNote(o.notePath)})}}if(r){let o=t.createEl("div",{cls:"backlink-counter-limit-message",text:`Showing top ${n} of ${i} notes`})}}}}renderEmptyState(){let e=this.container.createEl("div",{cls:"backlink-counter-empty-state"}),t=e.createEl("div",{cls:"empty-state-icon"});(0,E.setIcon)(t,"inbox");let n=e.createEl("div",{cls:"empty-state-text",text:"Add a folder or note to start showing stats"}),a=e.createEl("div",{cls:"empty-state-hint",text:`Click the ${this.state.watchMode==="folder"?"folder":"note"} button above to get started`})}renderFolderHeader(){var r;let e=(r=this.state.folderPath)==null?void 0:r[0];if(!e)return;let t=this.container.createEl("div",{cls:"backlink-counter-folder-header"}),n=t.createEl("div",{cls:"folder-info"}),a=n.createEl("span",{cls:"folder-icon",text:"\u{1F4C1}"}),i=n.createEl("span",{cls:"folder-name",text:e.endsWith("/")?e:e+"/"});if(this.onFolderRemovedCallback){let o=t.createEl("button",{cls:"folder-remove-button",attr:{"aria-label":`Remove folder ${e}`}});(0,E.setIcon)(o,"x"),o.addEventListener("click",s=>{s.stopPropagation(),this.removeFolder()})}}renderTopNMode(){let e=this.container.createEl("div",{cls:"backlink-counter-top-n"}),t=this.settingsService.getSettings().maxWatchedNotes,n=this.counterResults.slice(0,t);this.topNRenderer=new _(e);let a=y.getPeriodLabel(this.state.selectedPeriod);if(this.topNRenderer.render(n,a),this.counterResults.length>t){let i=e.createEl("div",{cls:"backlink-counter-limit-message",text:`Showing top ${t} of ${this.counterResults.length} notes`})}}renderPieMode(){let e=this.container.createEl("div",{cls:"backlink-counter-pie"}),t=this.settingsService.getSettings().maxWatchedNotes,n=this.counterResults.slice(0,t);this.pieRenderer=new V(e);let a=y.getPeriodLabel(this.state.selectedPeriod),i=this.settingsService.getSeriesColors();if(this.pieRenderer.render(n,a,i),this.counterResults.length>t){let r=e.createEl("div",{cls:"backlink-counter-limit-message",text:`Showing top ${t} of ${this.counterResults.length} notes`})}}renderTimeSeriesMode(){let e=this.container.createEl("div",{cls:"backlink-counter-time-series"}),t=this.settingsService.getSettings().maxWatchedNotes,n=this.counterResults.slice(0,t),a=this.settingsService.getSettings().firstDayOfWeek,i=y.calculateDateRange(this.state.selectedPeriod,a),r=[];for(let l of n){let d=this.app.vault.getAbstractFileByPath(l.notePath);if(d instanceof E.TFile){let h=this.analysisService.getBacklinksForFile(d),m=this.classifier.getDailyBacklinksInRange(h,i.startDate,i.endDate);r.push({notePath:d.path,noteTitle:d.basename,data:m})}}let o=this.settingsService.getSeriesColors(),s=ve(r,o);this.timeSeriesRenderer=new U(e);let c=y.getPeriodLabel(this.state.selectedPeriod);if(this.timeSeriesRenderer.render(s,c),this.counterResults.length>t){let l=e.createEl("div",{cls:"backlink-counter-limit-message",text:`Showing top ${t} of ${this.counterResults.length} notes`})}}showNoteSelector(){new B(this.app,t=>{this.addNote(t.path)}).open()}showFolderSelector(){new ee(this.app,t=>{this.addFolder(t.path)}).open()}getCountLabel(e){let t=y.getPeriodLabel(this.state.selectedPeriod);return`${e===1?"backlink":"backlinks"} in the ${t}`}getDisplayModeIcon(e){switch(e){case"default":return"list";case"top-n":return"bar-chart-2";case"pie":return"pie-chart";case"time-series":return"trending-up";default:return"list"}}getDisplayModeLabel(e){switch(e){case"default":return"Switch to bar chart view";case"top-n":return"Switch to pie chart view";case"pie":return"Switch to time-series view";case"time-series":return"Switch to list view";default:return"Switch display mode"}}getNextDisplayMode(e){switch(e){case"default":return"top-n";case"top-n":return"pie";case"pie":return"time-series";case"time-series":return"default";default:return"default"}}};var O="note-insights-view",te=class extends me.ItemView{constructor(t){super(t);this.currentNoteInfo=null;this.yearlyTracker=null;this.monthlyTracker=null;this.backlinkCounter=null;this.yearBounds=null;this.monthBounds=null;this.analysisService=null;this.settingsService=null;this.classifier=new M(this.app)}setAnalysisService(t){this.analysisService=t,this.containerEl.isShown()&&this.loadCurrentActiveNote()}setSettingsService(t){this.settingsService=t}getViewType(){return O}getDisplayText(){return"Note insights"}getIcon(){return"bar-chart-3"}updateNoteInfo(t,n,a){this.currentNoteInfo=t,n&&(this.yearBounds=n),a&&(this.monthBounds=a),this.render()}setOnYearChangeCallback(t){this.onYearChangeCallback=t}setOnMonthChangeCallback(t){this.onMonthChangeCallback=t}clearNoteInfo(){this.currentNoteInfo=null,this.yearlyTracker&&this.yearlyTracker.clear(),this.monthlyTracker&&this.monthlyTracker.clear(),this.backlinkCounter&&this.backlinkCounter.clear(),this.render()}render(){let t=this.containerEl;t.empty(),t.addClass("note-insights-view"),t.createEl("div",{cls:"note-insights-header"}).createEl("h3",{text:"Note insights",cls:"note-insights-title"});let a=t.createEl("div",{cls:"note-insights-content"});this.currentNoteInfo?this.renderNoteInsights(a):this.renderEmptyState(a)}renderEmptyState(t){t.createEl("div",{cls:"note-insights-empty"}).createEl("p",{text:"Open a note to see insights",cls:"note-insights-empty-text"})}renderNoteInsights(t){if(!this.currentNoteInfo)return;let n=t.createEl("div",{cls:"note-insights-section"});n.createEl("div",{text:"Active note",cls:"note-insights-label"}),n.createEl("div",{text:this.currentNoteInfo.noteTitle,cls:"note-insights-note-title"});let a=t.createEl("div",{cls:"note-insights-section"});if(a.createEl("div",{text:"counter",cls:"note-insights-label"}),this.analysisService&&this.settingsService){this.backlinkCounter&&this.backlinkCounter.cleanup();let i=a.createEl("div",{cls:"note-insights-backlink-counter"});this.backlinkCounter=new R(i,this.app,this.classifier,this.analysisService,this.settingsService);let r=this.app.workspace.getActiveFile();if(r){let o=this.analysisService.getBacklinksForFile(r);f.log("[NoteInsightsView] Counter - updating with backlinks:",o.length),this.backlinkCounter.updateData(o,r.basename,r.path)}else f.warn("[NoteInsightsView] Counter - no active file")}else f.error("[NoteInsightsView] Counter - analysisService is null! Cannot create counter."),a.createEl("div",{text:"Counter unavailable (service not initialized)",cls:"note-insights-error"});if(this.currentNoteInfo.yearlyData){let i=t.createEl("div",{cls:"note-insights-section"});i.createEl("div",{text:"Monthly tracker",cls:"note-insights-label"});let r=i.createEl("div",{cls:"note-insights-monthly-tracker"});this.monthlyTracker=new A(this.app,r,this.onMonthChangeCallback);let o=this.app.workspace.getActiveFile();o?this.monthlyTracker.updateData(this.currentNoteInfo.yearlyData,o.path):this.monthlyTracker.updateData(this.currentNoteInfo.yearlyData),this.monthBounds&&this.monthlyTracker.setMonthBounds(this.monthBounds)}if(this.currentNoteInfo.yearlyData){let i=t.createEl("div",{cls:"note-insights-section"});i.createEl("div",{text:"Yearly tracker",cls:"note-insights-label"});let r=i.createEl("div",{cls:"note-insights-yearly-tracker"});this.yearlyTracker=new Y(this.app,r,this.onYearChangeCallback);let o=this.app.workspace.getActiveFile();o?this.yearlyTracker.updateData(this.currentNoteInfo.yearlyData,o.path):this.yearlyTracker.updateData(this.currentNoteInfo.yearlyData),this.yearBounds&&this.yearlyTracker.setYearBounds(this.yearBounds)}}async onOpen(){this.loadCurrentActiveNote(),this.render()}loadCurrentActiveNote(){if(!this.analysisService)return;let t=this.app.workspace.getActiveFile();if(!t){this.clearNoteInfo();return}let n=this.analysisService.analyzeNote(t),a=this.analysisService.getYearBounds(t),i=this.analysisService.getMonthBounds(t);this.updateNoteInfo(n,a,i)}async onClose(){this.backlinkCounter&&this.backlinkCounter.cleanup(),this.currentNoteInfo=null,this.yearlyTracker=null,this.monthlyTracker=null,this.backlinkCounter=null}};var ne=class{constructor(e,t,n,a){this.view=null;this.app=e,this.plugin=t,this.analysisService=n,this.settingsService=a}setOnYearChangeCallback(e){this.onYearChangeCallback=e,this.view&&this.view.setOnYearChangeCallback(e)}setOnMonthChangeCallback(e){this.onMonthChangeCallback=e,this.view&&this.view.setOnMonthChangeCallback(e)}registerView(){this.plugin.registerView(O,e=>{let t=new te(e);return t.setAnalysisService(this.analysisService),t.setSettingsService(this.settingsService),this.onYearChangeCallback&&t.setOnYearChangeCallback(this.onYearChangeCallback),this.onMonthChangeCallback&&t.setOnMonthChangeCallback(this.onMonthChangeCallback),this.view=t,t}),this.plugin.addRibbonIcon("bar-chart-3","Note insights",()=>{this.activateView()})}async activateView(){var e;try{let t=(e=this.app.workspace.getLeavesOfType(O))==null?void 0:e[0];if(t)this.app.workspace.revealLeaf(t),this.view=t.view;else{let n=this.app.workspace.getRightLeaf(!1);n&&await n.setViewState({type:O,active:!0})}}catch(t){f.error("Vault Visualizer: Error activating view:",t)}}updateNoteInfo(e,t,n){this.ensureViewReference(),this.view&&typeof this.view.updateNoteInfo=="function"?this.view.updateNoteInfo(e,t,n):console.debug("Vault Visualizer: View not ready to update")}ensureViewReference(){var e;if(!this.view){let t=(e=this.app.workspace.getLeavesOfType(O))==null?void 0:e[0];if(t){if(this.view=t.view,!this.view.setAnalysisService)return;this.view.setAnalysisService(this.analysisService),this.onYearChangeCallback&&this.view.setOnYearChangeCallback(this.onYearChangeCallback),this.onMonthChangeCallback&&this.view.setOnMonthChangeCallback(this.onMonthChangeCallback)}}}clearNoteInfo(){this.view&&this.view.clearNoteInfo()}getView(){return this.view}cleanup(){this.view=null}};var ye=require("obsidian");var ue=require("obsidian");var x=class{constructor(e,t){this.instances=new Map;this.app=e,this.plugin=t}cleanupInstance(e){let t=this.instances.get(e);t&&(t.component&&typeof t.component.cleanup=="function"&&t.component.cleanup(),t.eventRef&&this.app.metadataCache.offref(t.eventRef),this.instances.delete(e))}getActiveCanvasFile(){let e=this.app.workspace.getMostRecentLeaf();if(!e)return null;let t=e.view;if(t.getViewType()!=="canvas")return null;let n=t.file;return!n||!(n instanceof ue.TFile)?null:n}isCanvasContext(e){return!e.sourcePath||e.sourcePath===""}parseCodeBlockConfig(e){let t={},n=e.trim().split(`
`);for(let a of n){let i=a.trim(),r=i.indexOf(":");if(r>0){let o=i.substring(0,r).trim(),s=i.substring(r+1).trim();t.hasOwnProperty(o)?Array.isArray(t[o])?t[o].push(s):t[o]=[t[o],s]:t[o]=s}}return t}generateInstanceId(e){return`${e.sourcePath}-${Date.now()}-${Math.random()}`}generateCodeblockId(){return Math.random().toString(36).substring(2,8)}async ensureCodeblockId(e,t,n){n||await this.updateCodeblockProperty(e,t,"id",t.codeblockId)}async updateCodeblockProperty(e,t,n,a){let i=this.normalizePropertyValue(a);this.isCanvasContext(e)?await this.updateCanvasNode(t,n,i):await this.updateNote(e,t,n,i),t.lastKnownPeriod=a}normalizePropertyValue(e){return Array.isArray(e)?e.map(t=>String(t)):[String(e)]}async updateCanvasNode(e,t,n){let a=this.getActiveCanvasFile();if(!a){f.error("[BaseCodeBlockProcessor] No active canvas file found");return}try{let i=await this.app.vault.read(a),r=JSON.parse(i),o=[];for(let s of r.nodes||[])s.type==="text"&&typeof s.text=="string"&&s.text.includes("```note-insight-")&&s.text.includes(`id: ${e.codeblockId}`)&&o.push(s);if(o.length===0){f.warn("[BaseCodeBlockProcessor] No matching canvas nodes found for ID:",e.codeblockId);return}for(let s of o){let c=s.text.split(`
`),l=this.updateCodeblockContent(c,e.codeblockId,t,n);s.text=l.join(`
`)}await this.app.vault.modify(a,JSON.stringify(r,null,2))}catch(i){f.error("[BaseCodeBlockProcessor] Canvas update error:",i)}}async updateNote(e,t,n,a){let i=this.app.vault.getAbstractFileByPath(e.sourcePath);if(!i||!(i instanceof ue.TFile)){f.error("[BaseCodeBlockProcessor] File not found:",e.sourcePath);return}try{let o=(await this.app.vault.read(i)).split(`
`),c=this.updateCodeblockContent(o,t.codeblockId,n,a).join(`
`);await this.app.vault.modify(i,c)}catch(r){f.error("[BaseCodeBlockProcessor] Note update error:",r)}}updateCodeblockContent(e,t,n,a){let i=!1,r=-1,o=-1,s=[];for(let l=0;l<e.length;l++){let d=e[l].trim();if(d.startsWith("```note-insight-"))i=!1,r=l;else if(i===!1&&r!==-1&&d.startsWith("id:")&&d.includes(t)){let h=d.match(/^id:\s*(.+)$/);h&&h[1].trim()===t&&(i=!0)}else if(d==="```"&&r!==-1)if(i){o=l;break}else r=-1,i=!1,s.length=0;i&&d.startsWith(`${n}:`)&&s.push(l)}if(r===-1||o===-1)return f.warn("[BaseCodeBlockProcessor] Target codeblock not found for ID:",t),e;for(let l=s.length-1;l>=0;l--)e.splice(s[l],1);let c=o-s.length-1;for(let l=0;l<a.length;l++){let d=`${n}: ${a[l]}`;e.splice(c+l+1,0,d)}return e}unload(){for(let e of this.instances.keys())this.cleanupInstance(e);this.instances.clear()}};function W(g,e,t=!1){let n=null;return function(...a){let i=this,r=function(){n=null,t||g.apply(i,a)},o=t&&!n;n&&clearTimeout(n),n=setTimeout(r,e),o&&g.apply(i,a)}}var ie=class extends x{constructor(t,n,a,i){super(t,n);this.analysisService=a,this.settingsService=i}register(){this.plugin.registerMarkdownCodeBlockProcessor("note-insight-counter",this.process.bind(this))}async process(t,n,a){var i,r,o;try{let s=this.parseConfig(t);if(!s){n.createEl("div",{text:"Error: notePath or notePaths not specified",cls:"note-insight-error"});return}let c=s.notePath&&s.notePath.length>0,l=s.folderPath&&s.folderPath.length>0;if(!(!c&&!l)&&!c&&!l){n.createEl("div",{text:"Error: notePath or folderPath must be specified",cls:"note-insight-error"});return}if(!s.id){n.createEl("div",{text:"Error: codeblock ID missing. Please insert codeblock using the context menu.",cls:"note-insight-error"});return}this.cleanupInstance(s.id);let h=n.createEl("div",{cls:"note-insight-code-block counter"}),m=h.createEl("div",{cls:"backlink-counter-wrapper"}),v=new R(m,this.app,this.analysisService.getClassifier(),this.analysisService,this.settingsService,p=>this.onPeriodChanged(a,s.id,p),p=>this.onNoteAdded(a,s.id,p),p=>this.onNoteRemoved(a,s.id,p),p=>this.onDisplayModeChanged(a,s.id,p),p=>this.onWatchModeChanged(a,s.id,p),p=>this.onFolderAdded(a,s.id,p),()=>this.onFolderRemoved(a,s.id)),C=(i=s.selectedPeriod)!=null?i:"past-30-days",k=(r=s.displayAs)!=null?r:"default",D=(o=s.watchMode)!=null?o:"note";v.setSelectedPeriod(C),v.setDisplayMode(k);let b=s.folderPath?[s.folderPath]:void 0;v.updateWatchedItems({notePath:s.notePath,displayAs:k,watchMode:D,folderPath:b});let S=this.app.metadataCache.on("resolved",W(()=>{var F;let p=this.instances.get(s.id);if(!p||p.isUpdatingCodeblock)return;let P=(F=s.displayAs)!=null?F:"default";p.notePath&&p.notePath.length>0?v.updateWatchedItems({notePath:p.notePath,displayAs:P}):s.folderPath&&v.updateWatchedItems({folderPath:[s.folderPath],displayAs:P,watchMode:"folder"})},5e3));this.plugin.registerEvent(S),this.instances.set(s.id,{component:v,codeblockId:s.id,eventRef:S,type:"counter",ctx:a,el:n,lastKnownPeriod:C,isUpdatingCodeblock:!1,notePath:s.notePath});let u=new ye.MarkdownRenderChild(h);u.onunload=()=>{this.cleanupInstance(s.id)},a.addChild(u)}catch(s){f.error("[CounterCodeBlockProcessor] Error:",s),n.createEl("div",{text:`Error rendering counter: ${s.message}`,cls:"note-insight-error"})}}parseConfig(t){let n=this.parseCodeBlockConfig(t);if(!n.id)throw new Error("Invalid code block config: missing required 'id' property");return n.notePath&&typeof n.notePath=="string"&&(n.notePath=[n.notePath]),(!n.notePath||!(typeof n.notePath=="string"||Array.isArray(n.notePath)))&&(n.notePath=[]),(!n.watchMode||!Object.values(j).includes(n.watchMode))&&(n.watchMode="note"),n.folderPath&&typeof n.folderPath!="string"&&(n.folderPath=String(n.folderPath)),(n.folderPath===""||n.folderPath==="undefined")&&delete n.folderPath,(!n.selectedPeriod||!Object.values(H).includes(n.selectedPeriod))&&(n.selectedPeriod="past-30-days"),(!n.displayMode||!Object.values(K).includes(n.displayMode))&&(n.displayMode="default"),this.config=n,n}async onPeriodChanged(t,n,a){let i=this.instances.get(n);if(f.warn("[CounterCodeBlockProcessor] Period changing to",a,"for instance",n,i),!(!i||i.isUpdatingCodeblock)&&i.lastKnownPeriod!==a){i.isUpdatingCodeblock=!0;try{await this.updateCodeblockProperty(t,i,"selectedPeriod",a)}finally{setTimeout(()=>{i.isUpdatingCodeblock=!1},100)}}}async onDisplayModeChanged(t,n,a){let i=this.instances.get(n);if(!(!i||i.isUpdatingCodeblock)){i.isUpdatingCodeblock=!0;try{await this.updateCodeblockProperty(t,i,"displayAs",a)}finally{setTimeout(()=>{i.isUpdatingCodeblock=!1},100)}}}async onNoteAdded(t,n,a){var r,o;f.log("[CounterCodeBlockProcessor] Adding note to watch list:",a);let i=this.instances.get(n);if(!(!i||i.isUpdatingCodeblock)){i.isUpdatingCodeblock=!0;try{((o=(r=this.config)==null?void 0:r.notePath)==null?void 0:o.includes(a))===!1&&(this.config.notePath.push(a),await this.updateCodeblockProperty(t,i,"notePath",this.config.notePath))}finally{setTimeout(()=>{i.isUpdatingCodeblock=!1},100)}}}async onNoteRemoved(t,n,a){var r,o;let i=this.instances.get(n);if(!(!i||i.isUpdatingCodeblock)){i.isUpdatingCodeblock=!0;try{(o=(r=this.config)==null?void 0:r.notePath)!=null&&o.includes(a)&&(this.config.notePath=this.config.notePath.filter(s=>s!==a),await this.updateCodeblockProperty(t,i,"notePath",this.config.notePath))}finally{setTimeout(()=>{i.isUpdatingCodeblock=!1},100)}}}async onWatchModeChanged(t,n,a){let i=this.instances.get(n);if(!(!i||i.isUpdatingCodeblock)){i.isUpdatingCodeblock=!0;try{await this.updateCodeblockProperty(t,i,"watchMode",a)}finally{setTimeout(()=>{i.isUpdatingCodeblock=!1},100)}}}async onFolderAdded(t,n,a){let i=this.instances.get(n);if(!(!i||i.isUpdatingCodeblock)){i.isUpdatingCodeblock=!0;try{await this.updateCodeblockProperty(t,i,"folderPath",a)}finally{setTimeout(()=>{i.isUpdatingCodeblock=!1},100)}}}async onFolderRemoved(t,n){let a=this.instances.get(n);if(!(!a||a.isUpdatingCodeblock)){a.isUpdatingCodeblock=!0;try{await this.updateCodeblockProperty(t,a,"folderPath",[])}finally{setTimeout(()=>{a.isUpdatingCodeblock=!1},100)}}}};var ke=require("obsidian");var ae=class extends x{constructor(t,n,a){super(t,n);this.analysisService=a}register(){this.plugin.registerMarkdownCodeBlockProcessor("note-insight-yearly",this.process.bind(this))}async process(t,n,a){try{let i=this.parseConfig(t);if(!i){n.createEl("div",{text:"Error: codeblock ID missing. Please insert codeblock using the context menu.",cls:"note-insight-error"});return}let{id:r,notePath:o,selectedYear:s}=i;if(!o){n.createEl("div",{text:"Error: notePath must be specified",cls:"note-insight-error"});return}let c=this.app.vault.getAbstractFileByPath(o);if(!c){n.createEl("div",{text:`Error: Note not found: ${o}`,cls:"note-insight-error"});return}let l=this.analysisService.analyzeNoteByPath(o);if(!l||!l.yearlyData){n.createEl("div",{text:"Error: Unable to analyze note",cls:"note-insight-error"});return}let d=this.analysisService.getYearBounds(c),h=n.createEl("div",{cls:"note-insight-code-block yearly"}),m=h.createEl("div",{cls:"yearly-tracker-wrapper"}),v=new Y(this.app,m,b=>this.onYearChanged(a,r,b));v.setYearBounds(d),v.updateData(l.yearlyData,o);let C=s!=null?s:new Date().getFullYear();v.setCurrentYear(C);let k=this.app.metadataCache.on("resolved",W(()=>{let b=this.instances.get(r);if(!b||b.isUpdatingCodeblock)return;let S=this.analysisService.analyzeNoteByPath(o);if(S&&S.yearlyData){let u=this.app.vault.getAbstractFileByPath(o);if(u){let p=this.analysisService.getYearBounds(u);v.setYearBounds(p),v.updateData(S.yearlyData,o)}}},5e3));this.plugin.registerEvent(k),this.instances.set(r,{component:v,codeblockId:r,eventRef:k,type:"yearly",ctx:a,el:n,lastKnownPeriod:C,isUpdatingCodeblock:!1});let D=new ke.MarkdownRenderChild(h);D.onunload=()=>{this.cleanupInstance(r)},a.addChild(D)}catch(i){f.error("[YearlyTrackerCodeBlockProcessor] Error:",i),n.createEl("div",{text:`Error: ${i.message}`,cls:"note-insight-error"})}}parseConfig(t){let n=this.parseCodeBlockConfig(t),a=n.id,i=n.notePath,r=n.selectedYear;if(!a||!i)return null;let o;if(r){let s=parseInt(r,10);isNaN(s)||(o=s)}return{id:a,notePath:i,selectedYear:o}}async onYearChanged(t,n,a){let i=this.instances.get(n);if(!(!i||i.isUpdatingCodeblock)&&i.lastKnownPeriod!==a){i.isUpdatingCodeblock=!0;try{await this.updateCodeblockProperty(t,i,"selectedYear",a)}finally{setTimeout(()=>{i.isUpdatingCodeblock=!1},100)}}}};var Ce=require("obsidian");var re=class extends x{constructor(t,n,a){super(t,n);this.analysisService=a}register(){this.plugin.registerMarkdownCodeBlockProcessor("note-insight-monthly",this.process.bind(this))}async process(t,n,a){try{let i=this.parseConfig(t);if(!i){n.createEl("div",{text:"Error: codeblock ID missing. Please insert codeblock using the context menu.",cls:"note-insight-error"});return}let{id:r,notePath:o,selectedMonth:s}=i;if(!o){n.createEl("div",{text:"Error: notePath must be specified",cls:"note-insight-error"});return}let c=this.app.vault.getAbstractFileByPath(o);if(!c){n.createEl("div",{text:`Error: Note not found: ${o}`,cls:"note-insight-error"});return}let l,d;if(s){let[u,p]=s.split("-");d=parseInt(u,10),l=parseInt(p,10)-1}else{let u=new Date;l=u.getMonth(),d=u.getFullYear()}let h=this.analysisService.getMonthlyData(c,l,d),m=this.analysisService.getMonthBounds(c),v=n.createEl("div",{cls:"note-insight-code-block monthly"}),C=v.createEl("div",{cls:"monthly-tracker-wrapper"}),k=new A(this.app,C,(u,p)=>this.onMonthChanged(a,r,u,p));k.setMonthBounds(m),k.updateData(h,o),k.setCurrentMonth(l,d);let D=this.app.metadataCache.on("resolved",W(()=>{let u=this.instances.get(r);if(!u||u.isUpdatingCodeblock)return;let p=this.app.vault.getAbstractFileByPath(o);if(p){let{month:P,year:T}=k.getCurrentMonth(),F=this.analysisService.getMonthlyData(p,P,T),N=this.analysisService.getMonthBounds(p);k.setMonthBounds(N),k.updateData(F,o)}},5e3));this.plugin.registerEvent(D);let b=`${d}-${String(l+1).padStart(2,"0")}`;this.instances.set(r,{component:k,codeblockId:r,eventRef:D,type:"monthly",ctx:a,el:n,lastKnownPeriod:b,isUpdatingCodeblock:!1});let S=new Ce.MarkdownRenderChild(v);S.onunload=()=>{this.cleanupInstance(r)},a.addChild(S)}catch(i){f.error("[MonthlyTrackerCodeBlockProcessor] Error:",i),n.createEl("div",{text:`Error: ${i.message}`,cls:"note-insight-error"})}}parseConfig(t){let n=this.parseCodeBlockConfig(t),a=n.id,i=n.notePath,r=n.selectedMonth;return!a||!i?null:{id:a,notePath:i,selectedMonth:r}}async onMonthChanged(t,n,a,i){let r=this.instances.get(n);if(!r||r.isUpdatingCodeblock)return;let o=`${i}-${String(a+1).padStart(2,"0")}`;if(r.lastKnownPeriod!==o){r.isUpdatingCodeblock=!0;try{await this.updateCodeblockProperty(t,r,"selectedMonth",o)}finally{setTimeout(()=>{r.isUpdatingCodeblock=!1},100)}}}};var oe=class{constructor(e,t){this.app=e,this.plugin=t}register(){this.plugin.registerEvent(this.app.workspace.on("editor-menu",(e,t,n)=>{this.addMenuItems(e,t)}))}addMenuItems(e,t){e.addSeparator(),e.addItem(n=>{n.setTitle("Add Yearly Tracker from Vault").setIcon("bar-chart-3").onClick(()=>{this.showNoteSelectorForYearly(t)})}),e.addItem(n=>{n.setTitle("Add Monthly Tracker from Vault").setIcon("calendar").onClick(()=>{this.showNoteSelectorForMonthly(t)})}),e.addItem(n=>{n.setTitle("Add Counter").setIcon("hash").onClick(()=>{this.insertCounterComponent(t)})})}generateCodeblockId(){return Math.random().toString(36).substring(2,8)}showNoteSelectorForYearly(e){new B(this.app,n=>{let i=`\`\`\`note-insight-yearly
id: ${this.generateCodeblockId()}
notePath: ${n.path}
\`\`\`
`;e.replaceSelection(i),this.resizeCanvasNodeIfNeeded(800,300)}).open()}showNoteSelectorForMonthly(e){new B(this.app,n=>{let i=`\`\`\`note-insight-monthly
id: ${this.generateCodeblockId()}
notePath: ${n.path}
\`\`\`
`;e.replaceSelection(i),this.resizeCanvasNodeIfNeeded(420,420)}).open()}insertCounterComponent(e){let n=`\`\`\`note-insight-counter
id: ${this.generateCodeblockId()}
\`\`\`
`;e.replaceSelection(n),this.resizeCanvasNodeIfNeeded(420,410)}resizeCanvasNodeIfNeeded(e,t){let n=this.app.workspace.getMostRecentLeaf();if(!n)return;let a=n.view;if(a.getViewType()==="canvas"){let i=a.canvas;if(i&&i.selection&&i.selection.size===1){let r=i.selection.values().next().value;r&&(typeof r.moveAndResize=="function"?r.moveAndResize({x:r.x,y:r.y,width:e,height:t}):typeof r.setSize=="function"?r.setSize({width:e,height:t}):typeof r.resize=="function"?r.resize({width:e,height:t}):(r.width=e,r.height=t,typeof i.requestSave=="function"&&i.requestSave()))}}}};var w=require("obsidian");var se=class extends w.PluginSettingTab{constructor(t,n){super(t,n);this.plugin=n}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Vault Visualizer Settings"}),new w.Setting(t).setName("First day of week").setDesc("Select the first day of the week for weekly period calculations.").addDropdown(i=>i.addOption("0","Sunday").addOption("1","Monday").addOption("2","Tuesday").addOption("3","Wednesday").addOption("4","Thursday").addOption("5","Friday").addOption("6","Saturday").setValue(String(this.plugin.settings.firstDayOfWeek)).onChange(async r=>{this.plugin.settings.firstDayOfWeek=parseInt(r),await this.plugin.saveSettings()})),new w.Setting(t).setName("Max watched notes").setDesc("Set the maximum number of notes that can be watched by backlink counter components (no more than 50 recommended).").addText(i=>i.setPlaceholder("50").setValue(String(this.plugin.settings.maxWatchedNotes)).onChange(async r=>{let o=parseInt(r);!isNaN(o)&&o>0&&(this.plugin.settings.maxWatchedNotes=o,await this.plugin.saveSettings())})),t.createEl("h3",{text:"Default Series Colors"}),t.createEl("p",{text:"Set default colors for up to 10 series in visualizations.",cls:"setting-item-description"}),new w.Setting(t).setName("Suggested color palette").setDesc("You can also customize individual series colors below by using the color picker.").addDropdown(i=>i.addOption("vibrant","Vibrant").addOption("pastel","Pastel Dreamland").setValue(this.plugin.settings.suggestedColorPalette).onChange(async r=>{let o=r;this.plugin.settings.suggestedColorPalette=o;let s=pe[o];for(let c=0;c<10;c++){let l=`series${c+1}Color`;this.plugin.settings[l]=s[c]}await this.plugin.saveSettings(),this.display()}));for(let i=1;i<=10;i++){let r=`series${i}Color`;new w.Setting(t).setName(`Series ${i} color`).addColorPicker(o=>o.setValue(this.plugin.settings[r]).onChange(async s=>{this.plugin.settings[r]=s,await this.plugin.saveSettings()}))}t.createEl("h3",{text:"Troubleshooting"}),new w.Setting(t).setName("Reload Obsidian").setDesc("If some changes are not taking effect, you can reload Obsidian to apply them.").addButton(i=>i.setButtonText("Reload").onClick(()=>{this.app.commands.executeCommandById("app:reload")})),t.createEl("h3",{text:"Advanced Settings"});let n=t.createEl("details",{cls:"vault-visualizer-advanced-settings"}),a=n.createEl("summary",{text:"Show advanced settings"});new w.Setting(n).setName("Log level").setDesc('Set the minimum log level for console output. Lower levels show more messages. Requires reload. You should not need to change this unless you are a developper troubleshooting an issue. Setting this to "Debug", or "Info" may produce a large volume of log messages and impact performance.').addDropdown(i=>i.addOption("0","Debug (all messages)").addOption("1","Info").addOption("2","Warning").addOption("3","Error (default)").addOption("4","None (silent)").setValue(String(this.plugin.settings.logLevel)).onChange(async r=>{this.plugin.settings.logLevel=parseInt(r),await this.plugin.saveSettings()}))}};var le=class extends be.Plugin{async onload(){await this.loadSettings(),f.setLevel(this.settings.logLevel),this.settingsService=new Q(this.settings),this.addSettingTab(new se(this.app,this)),this.dailyNoteClassifier=new M(this.app),this.analysisService=new J(this.app,this.dailyNoteClassifier),this.viewManager=new ne(this.app,this,this.analysisService,this.settingsService),this.viewManager.registerView(),this.backlinkWatcher=new X(this.app,this,this.analysisService,(t,n,a)=>{this.viewManager.updateNoteInfo(t,n,a)}),this.viewManager.setOnYearChangeCallback(t=>{this.backlinkWatcher.setCurrentYear(t)}),this.viewManager.setOnMonthChangeCallback((t,n)=>{this.backlinkWatcher.setCurrentMonth(t,n)}),this.backlinkWatcher.startWatching(),this.counterProcessor=new ie(this.app,this,this.analysisService,this.settingsService),this.counterProcessor.register(),this.yearlyProcessor=new ae(this.app,this,this.analysisService),this.yearlyProcessor.register(),this.monthlyProcessor=new re(this.app,this,this.analysisService),this.monthlyProcessor.register(),this.contextMenuManager=new oe(this.app,this),this.contextMenuManager.register(),this.registerEvent(this.app.workspace.on("quit",()=>{this.backlinkWatcher.stopWatching()}))}async onunload(){this.backlinkWatcher&&this.backlinkWatcher.stopWatching(),this.counterProcessor&&this.counterProcessor.unload(),this.yearlyProcessor&&this.yearlyProcessor.unload(),this.monthlyProcessor&&this.monthlyProcessor.unload(),this.viewManager&&this.viewManager.cleanup()}async loadSettings(){this.settings=Object.assign({},ge,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.settingsService&&this.settingsService.updateSettings(this.settings)}};
